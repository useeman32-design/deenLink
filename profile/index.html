<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic App | Profile</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary-green: #1D6F42;
            --light-green: #E8F5E9;
            --accent-gold: #D4AF37;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #E0E0E0;
            --dark-gray: #757575;
            --text-dark: #333333;
            --quran-blue: #1A5F7A;
            --mecca-red: #C62828;
            --medina-green: #2E7D32;
            --prayer-blue: #1976D2;
            --dua-teal: #00796B;
            --zakat-orange: #E65100;
            --fasting-cyan: #0097A7;
            --deenlink-purple: #6A1B9A;
            --ask-blue: #0D47A1;
            --ask-light-blue: #E3F2FD;
            --success-green: #27ae60;
        }

        /* Dark Theme Variables */
        .dark-theme {
            --primary-green: #2ecc71;
            --light-green: #1a2526;
            --accent-gold: #f39c12;
            --white: #2c3e50;
            --light-gray: #34495e;
            --medium-gray: #4a6572;
            --dark-gray: #bdc3c7;
            --text-dark: #ecf0f1;
            --quran-blue: #3498db;
            --mecca-red: #e74c3c;
            --medina-green: #27ae60;
            --prayer-blue: #3498db;
            --dua-teal: #1abc9c;
            --zakat-orange: #e67e22;
            --fasting-cyan: #1abc9c;
            --deenlink-purple: #9b59b6;
            --ask-blue: #3498db;
            --ask-light-blue: #1a3a5f;
            --success-green: #2ecc71;
        }

        body {
            background-color: var(--light-gray);
            color: var(--text-dark);
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* FIX: Remove all initial loading styles */
        body {
            opacity: 1 !important;
            visibility: visible !important;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            position: relative;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 100%;
            }
        }

        /* Page Loader - Only for page transitions */
        #pageLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #pageLoader.active {
            display: flex;
            opacity: 1;
        }

        /* FIXED: Default Islamic Loader from your code */
        .islamic-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
        }

        .loader-crescent {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .crescent {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-gold));
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            animation: crescentFloat 3s ease-in-out infinite;
        }

        .crescent::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 50%;
        }

        .loader-star {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--accent-gold);
            font-size: 24px;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        .loader-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1px;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes crescentFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        @keyframes starTwinkle {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        @keyframes textPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Top Section - Profile Header */
        .top-section {
            height: 180px;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .top-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(29, 111, 66, 0.9) 0%, rgba(29, 111, 66, 0.8) 100%);
            z-index: 1;
        }

        .dark-theme .top-section::before {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.9) 0%, rgba(46, 204, 113, 0.8) 100%);
        }

        .top-section-background {
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1522441815192-d9f04eb0615c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* FIXED: Top bar with centered profile text and proper spacing */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            z-index: 10;
        }

        @media (min-width: 768px) {
            .top-bar {
                padding: 20px 30px;
            }
        }

        /* FIXED: Profile text centered in header */
        .page-title {
            color: white;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
        }

        .page-title i {
            font-size: 22px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* FIXED: DeenPoints container next to settings with better spacing */
        .top-right-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        @media (max-width: 320px) {
            .top-right-container {
                gap: 5px;
            }
        }

        .deenpoints-balance {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        @media (max-width: 320px) {
            .deenpoints-balance {
                padding: 6px 8px;
                font-size: 13px;
            }
            
            .deenpoints-balance img {
                width: 18px !important;
                height: 18px !important;
            }
        }

        .deenpoints-balance:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .deenpoints-balance img {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .settings-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }

        @media (max-width: 320px) {
            .settings-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Profile Info Section */
        .profile-info-section {
            position: relative;
            margin-top: -60px;
            z-index: 5;
            padding: 0 16px;
        }

        @media (min-width: 768px) {
            .profile-info-section {
                padding: 0 30px;
            }
        }

        .profile-card {
            background-color: var(--white);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-image-container {
            position: relative;
            margin-top: -70px;
            margin-bottom: 15px;
        }

        .profile-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--white);
            object-fit: cover;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .edit-profile-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), #4CAF50);
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(29, 111, 66, 0.3);
        }

        .edit-profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(29, 111, 66, 0.4);
        }

        /* NEW: Edit Profile Text Button (next to profile photo) */
        .edit-profile-text-btn {
            position: absolute;
            bottom: -15px;
            right: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary-green), #4CAF50);
            border: none;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 4px 12px rgba(29, 111, 66, 0.3);
            white-space: nowrap;
            z-index: 10;
        }

        .edit-profile-text-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(29, 111, 66, 0.4);
        }

        @media (max-width: 380px) {
            .edit-profile-text-btn {
                padding: 5px 10px;
                font-size: 11px;
                bottom: -12px;
            }
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .profile-username {
            font-size: 14px;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }

        .profile-bio {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.5;
            max-width: 400px;
            margin: 0 auto 15px;
        }

        .profile-bio i {
            color: var(--primary-green);
            margin-right: 5px;
        }

        /* FIXED: Profile Stats without DeenPoints */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 320px) {
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
        }

        .stat-item {
            padding: 12px 8px;
            background-color: var(--light-gray);
            border-radius: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-item:hover {
            background-color: var(--medium-gray);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--dark-gray);
            font-weight: 500;
        }

        .stat-item.posts .stat-value {
            color: var(--primary-green);
        }

        .stat-item.followers .stat-value {
            color: var(--primary-green);
        }

        .stat-item.following .stat-value {
            color: var(--primary-green);
        }

        .stat-item.donations .stat-value {
            color: var(--primary-green);
        }

        /* FIXED: Profile actions - now with 3 buttons for better spacing */
        .profile-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
        }

        @media (max-width: 480px) {
            .profile-actions {
                gap: 8px;
            }
        }

        .action-btn {
            flex: 1;
            min-width: 0;
            padding: 12px 8px;
            border-radius: 12px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (max-width: 380px) {
            .action-btn {
                font-size: 12px;
                padding: 10px 6px;
                gap: 5px;
            }
            
            .action-btn i {
                font-size: 13px;
            }
        }

        @media (max-width: 320px) {
            .profile-actions {
                flex-wrap: wrap;
            }
            
            .action-btn {
                min-width: calc(33.333% - 6px);
                margin-bottom: 0;
            }
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--primary-green), #4CAF50);
            color: white;
            box-shadow: 0 4px 12px rgba(29, 111, 66, 0.2);
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(29, 111, 66, 0.3);
        }

        .action-btn.secondary {
            background-color: var(--light-gray);
            color: var(--text-dark);
            border: 1px solid var(--medium-gray);
        }

        .action-btn.secondary:hover {
            background-color: var(--medium-gray);
            transform: translateY(-2px);
        }

        .action-btn.checkin {
            background: linear-gradient(135deg, var(--accent-gold), #FFD54F);
            color: white;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        }

        .action-btn.checkin:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.3);
        }

        .action-btn.checked-in {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            cursor: default;
        }

        .action-btn.checked-in:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
        }

        .action-btn.donate {
            background: linear-gradient(135deg, var(--zakat-orange), #FF9800);
            color: white;
            box-shadow: 0 4px 12px rgba(230, 81, 0, 0.2);
        }

        .action-btn.donate:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(230, 81, 0, 0.3);
        }

        /* Posts Section */
        .posts-section {
            padding: 20px 16px 100px;
        }

        @media (min-width: 768px) {
            .posts-section {
                padding: 25px 30px 120px;
                max-width: 700px;
                margin: 0 auto;
            }
        }

        .posts-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .posts-title i {
            color: var(--primary-green);
        }

        /* Text Post Cards with enhanced interaction */
        .text-posts {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .text-post-card {
            background-color: var(--white);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .text-post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--medium-gray);
        }

        /* FIXED: Post header with user info (only photo and username) */
        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .post-user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 13px;
            margin-bottom: 2px;
        }

        .post-user-username {
            font-size: 11px;
            color: var(--dark-gray);
            margin-bottom: 2px;
        }

        .post-content {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-dark);
            margin-bottom: 14px;
            white-space: pre-line;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--light-gray);
        }

        .post-time {
            font-size: 11px;
            color: var(--dark-gray);
        }

        .post-stats {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .post-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: var(--dark-gray);
            cursor: pointer;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .post-stat:hover {
            background-color: var(--light-gray);
        }

        .post-stat i {
            font-size: 14px;
            transition: all 0.2s;
        }

        .post-stat.liked i {
            color: #e74c3c;
        }

        .post-stat.liked {
            color: #e74c3c;
        }

        /* Comment Section - FIXED: Reduced size */
        .comments-section {
            margin-top: 12px;
            padding: 12px;
            background-color: var(--light-gray);
            border-radius: 10px;
            display: none;
        }

        .comments-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .comment:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .comment-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
            min-width: 0;
        }

        .comment-author {
            font-weight: 600;
            font-size: 12px;
            color: var(--text-dark);
            margin-bottom: 2px;
        }

        .comment-text {
            font-size: 12px;
            color: var(--text-dark);
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin-bottom: 4px;
        }

        /* FIXED: Comment time and like button on same line */
        .comment-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 2px;
        }

        .comment-time {
            font-size: 10px;
            color: var(--dark-gray);
        }

        /* FIXED: Comment Like Button - Same line as time */
        .comment-like {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 11px;
            color: var(--dark-gray);
            cursor: pointer;
            transition: all 0.2s;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .comment-like:hover {
            background-color: var(--medium-gray);
        }

        .comment-like i {
            font-size: 12px;
            transition: all 0.2s;
        }

        .comment-like.liked i {
            color: #e74c3c;
        }

        .comment-like.liked {
            color: #e74c3c;
        }

        .add-comment {
            display: flex;
            gap: 6px;
            margin-top: 12px;
        }

        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 15px;
            font-size: 12px;
            color: var(--text-dark);
            background-color: var(--white);
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .send-comment-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .send-comment-btn:hover {
            background-color: #155c35;
            transform: scale(1.05);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Daily Check-in Modal - Fixed to match your code */
        .daily-checkin-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .daily-checkin-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .daily-checkin-content {
            background: linear-gradient(135deg, #1D6F42, #2E7D32);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            color: white;
            max-width: 350px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .daily-checkin-icon {
            font-size: 50px;
            color: var(--accent-gold);
            margin-bottom: 15px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-10px);
            }
        }

        .daily-checkin-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .daily-checkin-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .daily-checkin-reward {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .reward-amount {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .reward-amount img {
            width: 32px;
            height: 32px;
        }

        .reward-text {
            font-size: 12px;
            opacity: 0.9;
        }

        .daily-checkin-btn {
            background-color: var(--accent-gold);
            color: #333;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .daily-checkin-btn:hover {
            background-color: #e6c158;
            transform: scale(1.05);
        }

        /* FIXED: Edit Profile Modal - Properly Styled */
        .edit-profile-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .edit-profile-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .edit-profile-modal-content {
            background-color: var(--white);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .edit-profile-modal-overlay.active .edit-profile-modal-content {
            transform: translateY(0);
        }

        .edit-profile-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background-color: var(--white);
            z-index: 10;
            border-radius: 20px 20px 0 0;
        }

        .edit-profile-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .edit-profile-modal-title i {
            font-size: 20px;
            color: var(--primary-green);
        }

        .edit-profile-modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark-gray);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .edit-profile-modal-close:hover {
            background-color: var(--light-gray);
            color: var(--text-dark);
        }

        /* FIXED: Edit Profile Form Styling */
        .edit-profile-modal-body {
            padding: 20px;
        }

        .edit-profile-form-group {
            margin-bottom: 20px;
        }

        .edit-profile-form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .edit-profile-form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            font-size: 15px;
            color: var(--text-dark);
            background-color: var(--white);
            transition: all 0.3s;
        }

        .edit-profile-form-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(29, 111, 66, 0.1);
        }

        .edit-profile-form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            font-size: 15px;
            color: var(--text-dark);
            background-color: var(--white);
            transition: all 0.3s;
            resize: vertical;
            min-height: 100px;
            font-family: 'Poppins', sans-serif;
        }

        .edit-profile-form-textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(29, 111, 66, 0.1);
        }

        .edit-profile-form-checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-profile-form-checkbox {
            width: 18px;
            height: 18px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .edit-profile-form-checkbox:checked {
            background-color: var(--primary-green);
            border-color: var(--primary-green);
        }

        .edit-profile-form-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .edit-profile-form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .edit-profile-form-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edit-profile-form-btn.save {
            background: linear-gradient(135deg, var(--primary-green), #4CAF50);
            color: white;
            box-shadow: 0 4px 12px rgba(29, 111, 66, 0.2);
        }

        .edit-profile-form-btn.save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(29, 111, 66, 0.3);
        }

        .edit-profile-form-btn.cancel {
            background-color: var(--light-gray);
            color: var(--text-dark);
        }

        .edit-profile-form-btn.cancel:hover {
            background-color: var(--medium-gray);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: var(--white);
            z-index: 10;
            border-radius: 20px 20px 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--dark-gray);
            font-size: 20px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .close-modal:hover {
            background-color: var(--light-gray);
        }

        .modal-body {
            padding: 20px;
        }

        /* Purchase Options */
        .purchase-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 480px) {
            .purchase-options {
                grid-template-columns: 1fr;
            }
        }

        .purchase-option {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--medium-gray);
            background-color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .purchase-option:hover {
            border-color: var(--accent-gold);
            transform: translateY(-3px);
        }

        .purchase-option.selected {
            border-color: var(--accent-gold);
            background-color: rgba(212, 175, 55, 0.1);
        }

        .purchase-amount {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .purchase-amount img {
            width: 20px;
            height: 20px;
        }

        .purchase-cost {
            font-size: 14px;
            color: var(--dark-gray);
        }

        .custom-purchase {
            grid-column: 1 / -1;
        }

        .custom-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* FIXED: Custom Amount input field styling */
        .custom-input-group input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            font-size: 15px;
            color: var(--text-dark);
            background-color: var(--white);
            transition: all 0.3s;
        }

        .custom-input-group input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(29, 111, 66, 0.1);
        }

        .currency {
            font-size: 14px;
            color: var(--dark-gray);
            white-space: nowrap;
        }

        /* Purchase Success Modal */
        .purchase-success {
            text-align: center;
            padding: 30px 20px;
        }

        .purchase-success-icon {
            width: 80px;
            height: 80px;
            background-color: var(--success-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            color: white;
            font-size: 36px;
            animation: successPulse 2s ease infinite;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .purchase-success-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--success-green);
            margin-bottom: 15px;
        }

        .purchase-success-message {
            font-size: 16px;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .purchase-success-details {
            background-color: var(--light-green);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .purchase-success-amount {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .purchase-success-amount img {
            width: 28px;
            height: 28px;
        }

        .purchase-success-cost {
            font-size: 16px;
            color: var(--dark-gray);
            margin-bottom: 5px;
        }

        .purchase-success-balance {
            font-size: 14px;
            color: var(--text-dark);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--medium-gray);
        }

        .close-success-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .close-success-btn:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        /* Important Note Box */
        .important-note {
            background-color: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-gold);
        }

        .important-note-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 8px;
        }

        .important-note-text {
            font-size: 13px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Info Box */
        .info-box {
            margin-top: 10px;
            padding: 16px;
            background-color: rgba(29, 111, 66, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--primary-green);
        }

        .dark-theme .info-box {
            background-color: rgba(46, 204, 113, 0.1);
        }

        .info-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 8px;
        }

        .info-text {
            font-size: 13px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Modal Navigation */
        .modal-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--medium-gray);
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 480px) {
            .modal-btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }

        .btn-secondary {
            background-color: var(--medium-gray);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            background-color: var(--dark-gray);
            color: white;
        }

        .btn-primary {
            background-color: var(--primary-green);
            color: white;
        }

        .btn-primary:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background-color: var(--dark-gray);
            cursor: not-allowed;
            transform: none;
        }

        /* Earn DeenPoints Section */
        .earn-deenpoints {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-green);
            border-radius: 12px;
        }

        .earn-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .earn-methods {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .earn-method {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-dark);
        }

        .earn-method i {
            color: var(--primary-green);
            font-size: 14px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            background-color: var(--white);
            box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.08);
            padding: 12px 0;
            z-index: 100;
            border-radius: 0;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                max-width: 768px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 20px 20px 0 0;
                margin-bottom: 10px;
            }
        }

        @media (min-width: 1024px) {
            .bottom-nav {
                max-width: 480px;
            }
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--dark-gray);
            text-decoration: none;
            transition: color 0.3s;
            cursor: pointer;
            padding: 5px 0;
            position: relative;
        }

        .nav-item:hover {
            color: var(--primary-green);
        }

        .nav-item.active {
            color: var(--primary-green);
        }

        .nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-align: center;
            line-height: 1.1;
        }

        /* Nav Loader Animation */
        .nav-loader {
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: var(--primary-green);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav-item.loading .nav-loader {
            opacity: 1;
            animation: pulseLoader 1s infinite;
        }

        @keyframes pulseLoader {
            0%, 100% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scale(1.5);
                opacity: 0.7;
            }
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .profile-image {
                width: 100px;
                height: 100px;
            }
            
            .profile-name {
                font-size: 22px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .stat-label {
                font-size: 10px;
            }
            
            .profile-actions {
                gap: 6px;
            }
            
            .action-btn {
                font-size: 12px;
                padding: 10px;
                gap: 5px;
            }
        }

        @media (max-width: 320px) {
            .page-title {
                font-size: 18px;
            }
            
            .deenpoints-balance {
                font-size: 12px;
                padding: 5px 8px;
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-btn {
                font-size: 11px;
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body class="light-theme">
    <!-- Page Loader - Only for page transitions -->
    <div id="pageLoader">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Daily Check-in Modal - Fixed from your code -->
    <div class="daily-checkin-modal" id="dailyCheckinModal">
        <div class="daily-checkin-content">
            <div class="daily-checkin-icon">
                <i class="fas fa-gift"></i>
            </div>
            <h2 class="daily-checkin-title">Daily Reward!</h2>
            <p class="daily-checkin-subtitle">Check in daily to earn DeenPoints</p>
            
            <div class="daily-checkin-reward">
                <div class="reward-amount">
                    <img src="../img/deenPoints.png" alt="DeenPoints">
                    <span>5</span>
                </div>
                <p class="reward-text">DeenPoints added to your account</p>
            </div>
            
            <button class="daily-checkin-btn" id="claimDailyRewardBtn">
                <i class="fas fa-coins"></i>
                Claim 5 DeenPoints
            </button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="edit-profile-modal-overlay" id="editProfileModalOverlay">
        <div class="edit-profile-modal-content">
            <div class="edit-profile-modal-header">
                <div class="edit-profile-modal-title">
                    <i class="fas fa-user-edit"></i>
                    <span>Edit Profile</span>
                </div>
                <button class="edit-profile-modal-close" id="editProfileModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="edit-profile-modal-body">
                <form id="editProfileForm">
                    <div class="edit-profile-form-group">
                        <label class="edit-profile-form-label" for="editName">Full Name</label>
                        <input type="text" class="edit-profile-form-input" id="editName" placeholder="Enter your full name" value="Ahmad Ali">
                    </div>
                    
                    <div class="edit-profile-form-group">
                        <label class="edit-profile-form-label" for="editUsername">Username</label>
                        <input type="text" class="edit-profile-form-input" id="editUsername" placeholder="Enter username" value="ahmadalidev">
                    </div>
                    
                    <div class="edit-profile-form-group">
                        <label class="edit-profile-form-label" for="editBio">Bio</label>
                        <textarea class="edit-profile-form-textarea" id="editBio" placeholder="Tell others about yourself">Muslim Developer â€¢ Quran Memorizer â€¢ Love for Deen & Dunya</textarea>
                    </div>
                    
                    <div class="edit-profile-form-group">
                        <label class="edit-profile-form-label">Profile Picture</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                            <img src="https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80" alt="Current Profile" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                            <button type="button" class="action-btn secondary" id="changePhotoBtn" style="flex: 1; padding: 10px;">
                                <i class="fas fa-camera"></i>
                                Change Photo
                            </button>
                        </div>
                    </div>
                    
                    <div class="edit-profile-form-group">
                        <label class="edit-profile-form-label">Privacy Settings</label>
                        <div class="edit-profile-form-checkbox-group">
                            <input type="checkbox" class="edit-profile-form-checkbox" id="hideCharityBalance">
                            <label class="edit-profile-form-label" for="hideCharityBalance" style="margin: 0;">Hide charity balance from profile</label>
                        </div>
                        <div class="edit-profile-form-checkbox-group">
                            <input type="checkbox" class="edit-profile-form-checkbox" id="privateAccount">
                            <label class="edit-profile-form-label" for="privateAccount" style="margin: 0;">Make account private</label>
                        </div>
                    </div>
                    
                    <div class="edit-profile-form-buttons">
                        <button type="button" class="edit-profile-form-btn cancel" id="cancelEditProfileBtn">Cancel</button>
                        <button type="submit" class="edit-profile-form-btn save" id="saveEditProfileBtn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Purchase DeenPoints Modal -->
    <div class="modal-overlay" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-coins"></i>
                    <span>Purchase DeenPoints</span>
                </div>
                <button class="close-modal" id="closePurchaseModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Purchase Success Content -->
                <div class="purchase-success" id="purchaseSuccessContent" style="display: none;">
                    <div class="purchase-success-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 class="purchase-success-title">Purchase Successful!</h2>
                    <p class="purchase-success-message">Your DeenPoints have been added to your account.</p>
                    
                    <div class="purchase-success-details">
                        <div class="purchase-success-amount" id="purchaseSuccessAmount">
                            <img src="../img/deenPoints.png" alt="DeenPoints">
                            <span>0</span>
                        </div>
                        <div class="purchase-success-cost" id="purchaseSuccessCost">â‚¦0.00</div>
                        <div class="purchase-success-balance">
                            New Balance: <strong id="newBalance">750</strong> DeenPoints
                        </div>
                    </div>
                    
                    <button class="close-success-btn" id="closeSuccessBtn">
                        <i class="fas fa-check-circle"></i>
                        Continue
                    </button>
                </div>
                
                <!-- Purchase Form Content -->
                <div id="purchaseFormContent">
                    <div class="info-box">
                        <div class="info-title">
                            <i class="fas fa-info-circle"></i>
                            <span>Current Balance</span>
                        </div>
                        <div class="info-text">
                            <div style="display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: 600;">
                                <img src="../img/deenPoints.png" alt="DeenPoints" style="width: 24px; height: 24px;">
                                <span id="currentBalanceDisplay">750</span>
                                <span>DeenPoints</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Quick Purchase Options</label>
                        <div class="purchase-options">
                            <div class="purchase-option" data-points="500" data-cost="750">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>500</span>
                                </div>
                                <div class="purchase-cost">â‚¦750</div>
                            </div>
                            <div class="purchase-option" data-points="1000" data-cost="1500">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>1,000</span>
                                </div>
                                <div class="purchase-cost">â‚¦1,500</div>
                            </div>
                            <div class="purchase-option" data-points="2500" data-cost="3750">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>2,500</span>
                                </div>
                                <div class="purchase-cost">â‚¦3,750</div>
                            </div>
                            <div class="purchase-option" data-points="5000" data-cost="7500">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>5,000</span>
                                </div>
                                <div class="purchase-cost">â‚¦7,500</div>
                            </div>
                            <div class="purchase-option custom-purchase">
                                <label class="form-label">Custom Amount</label>
                                <div class="custom-input-group">
                                    <input type="number" class="form-input" id="customDeenPoints" min="100" max="10000" placeholder="Enter amount">
                                    <span class="currency">DeenPoints</span>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: var(--dark-gray);">
                                    Cost: <span id="customCostDisplay">â‚¦0.00</span> (â‚¦1.5 per DeenPoint)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="important-note">
                        <div class="important-note-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Important Note</span>
                        </div>
                        <div class="important-note-text">
                            âš ï¸ DeenPoints do NOT buy fatwas or opinions. Scholars answer only according to Islamic evidence and knowledge. DeenLink just helps in setting the priority and urgency of your questions.
                        </div>
                    </div>
                    
                    <div class="earn-deenpoints">
                        <div class="earn-title">
                            <i class="fas fa-coins"></i>
                            <span>Earn DeenPoints by:</span>
                        </div>
                        <div class="earn-methods">
                            <div class="earn-method">
                                <i class="fas fa-quran"></i>
                                <span>Participation in app activities like reading Quran, prayer times etc.</span>
                            </div>
                            <div class="earn-method">
                                <i class="fas fa-users"></i>
                                <span>Contributing to the community</span>
                            </div>
                            <div class="earn-method">
                                <i class="fas fa-handshake"></i>
                                <span>Supporting the DeenLink project</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-navigation">
                        <button class="modal-btn btn-secondary" id="cancelPurchaseBtn">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button class="modal-btn btn-primary" id="confirmPurchaseBtn">
                            <i class="fas fa-shopping-cart"></i>
                            Purchase
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-content" id="pageContent">
            <!-- Top Section -->
            <section class="top-section">
                <div class="top-section-background"></div>
                
                <!-- FIXED: Top bar with centered profile text -->
                <div class="top-bar">
                    <button class="back-btn" id="backBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    
                    <!-- FIXED: Profile text centered -->
                    <div class="page-title">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </div>
                    
                    <!-- FIXED: DeenPoints and Settings aligned to right with better spacing -->
                    <div class="top-right-container">
                        <div class="deenpoints-balance" id="deenpointsBalanceBtn">
                            <img src="../img/deenPoints.png" alt="DeenPoints">
                            <span id="userDeenPoints">750</span>
                        </div>
                        <!-- FIXED: Settings button -->
                        <button class="settings-btn" id="settingsBtn">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Profile Info Section -->
            <div class="profile-info-section">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-image-container">
                            <img src="https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Profile" class="profile-image">
                            <!-- Edit Profile Button moved here (only camera icon) -->
                            <button class="edit-profile-btn" id="editProfileImageBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                            <!-- NEW: Edit Profile Text Button added next to photo -->
                            <button class="edit-profile-text-btn" id="editProfileTextBtn">
                                <i class="fas fa-edit"></i>
                                <span>Edit</span>
                            </button>
                        </div>
                        
                        <h1 class="profile-name">Ahmad Ali</h1>
                        <div class="profile-username">@ahmadalidev</div>
                        
                        <div class="profile-bio">
                            <i class="fas fa-quote-left"></i>
                            Muslim Developer â€¢ Quran Memorizer â€¢ Love for Deen & Dunya
                            <i class="fas fa-quote-right"></i>
                        </div>
                        
                        <!-- FIXED: Profile stats without DeenPoints -->
                        <div class="profile-stats">
                            <div class="stat-item posts">
                                <div class="stat-value">47</div>
                                <div class="stat-label">Posts</div>
                            </div>
                            <div class="stat-item followers">
                                <div class="stat-value">1.2K</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat-item following">
                                <div class="stat-value">348</div>
                                <div class="stat-label">Following</div>
                            </div>
                            <div class="stat-item donations">
                                <div class="stat-value">$2.5K</div>
                                <div class="stat-label">Charity</div>
                            </div>
                        </div>
                        
                        <!-- FIXED: Now with 3 buttons that have better spacing -->
                        <div class="profile-actions">
                            <button class="action-btn secondary" id="shareProfileBtn">
                                <i class="fas fa-share-alt"></i>
                                <span>Share Profile</span>
                            </button>
                            <!-- Check-in button -->
                            <button class="action-btn checkin" id="checkinBtn">
                                <i class="fas fa-calendar-check"></i>
                                <span>Check In</span>
                            </button>
                            <!-- Donate button -->
                            <button class="action-btn donate" id="donateBtn">
                                <i class="fas fa-heart"></i>
                                <span>Donate</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Posts Section -->
            <section class="posts-section">
                <h2 class="posts-title">
                    <i class="fas fa-feather-alt"></i>
                    <span>My Posts</span>
                </h2>
                
                <div class="text-posts" id="textPosts">
                    <!-- Posts will be rendered here -->
                </div>
            </section>

            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <a href="../index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-home"></i>
                    <span class="nav-label">Home</span>
                </a>
                <a href="../quranHadith/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-quran"></i>
                    <span class="nav-label">Quran &<br>Hadith</span>
                </a>
                <a href="../tools/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-pray"></i>
                    <span class="nav-label">Worship<br>Tools</span>
                </a>
                <a href="../learning/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-graduation-cap"></i>
                    <span class="nav-label">Learning</span>
                </a>
                <a href="#" class="nav-item active">
                    <div class="nav-loader"></div>
                    <i class="fas fa-user"></i>
                    <span class="nav-label">Profile</span>
                </a>
            </nav>
        </div>
    </div>

    <script>
        // ============================================
        // FIXED: COMPLETELY REMOVED BLINKING ISSUE
        // ============================================

        // Show content immediately
        document.addEventListener('DOMContentLoaded', function() {
            // Page is already loaded, content is visible
            document.body.classList.add('loaded');
            
            // Set active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.nav-item[href="#"]').classList.add('active');
            
            // Initialize app
            initializeApp();
        });

        // Page loader for transitions only
        const pageLoader = document.getElementById('pageLoader');

        // Function to show page loader (only for page transitions)
        function showPageLoader() {
            pageLoader.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Function to hide page loader
        function hidePageLoader() {
            pageLoader.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Function to check if two URLs are the same page
        function isSamePage(href, currentUrl) {
            const currentPath = window.location.pathname;
            
            if (href === '' || href === '#' || href === './' || href === '/') {
                return currentPath.endsWith('/') || 
                       currentPath.endsWith('index.html') || 
                       currentPath === '/';
            }
            
            const cleanHref = href.split('?')[0].split('#')[0];
            const cleanCurrentPath = currentPath.split('?')[0].split('#')[0];
            
            const normalizePath = (path) => {
                path = path.replace(/^\/|\/$/g, '');
                path = path.replace(/index\.html$/i, '');
                return path;
            };
            
            const normalizedHref = normalizePath(cleanHref);
            const normalizedCurrent = normalizePath(cleanCurrentPath);
            
            return normalizedHref === normalizedCurrent;
        }

        // Intercept all link clicks for smooth page transitions
        document.addEventListener('click', function(e) {
            const anchor = e.target.closest('a');
            
            if (!anchor) return;
            
            const href = anchor.getAttribute('href');
            
            if (!href || 
                href.startsWith('javascript:') || 
                href.startsWith('mailto:') || 
                href.startsWith('tel:') ||
                href.startsWith('#') ||
                anchor.getAttribute('target') === '_blank') {
                return;
            }
            
            if (href.startsWith('http') && !href.includes(window.location.origin)) {
                return;
            }
            
            if (isSamePage(href, window.location.href)) {
                if (anchor.classList.contains('nav-item')) {
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    anchor.classList.add('active');
                }
                return;
            }
            
            e.preventDefault();
            
            // Show loading state on nav item
            if (anchor.classList.contains('nav-item')) {
                anchor.classList.add('loading');
            }
            
            showPageLoader();
            
            // Navigate with minimal delay
            setTimeout(() => {
                window.location.href = href;
            }, 300);
        });

        // Handle browser back/forward
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                hidePageLoader();
            }
        });

        // ============================================
        // APPLICATION STATE
        // ============================================

        const state = {
            user: {
                name: 'Ahmad Ali',
                username: '@ahmadalidev',
                bio: 'Muslim Developer â€¢ Quran Memorizer â€¢ Love for Deen & Dunya',
                posts: 47,
                followers: 1256,
                following: 348,
                donations: 2500,
                deenpoints: 750,
                profileImage: 'https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80',
                hideCharityBalance: false,
                privateAccount: false
            },
            posts: [
                {
                    id: 1,
                    content: `"The best among you are those who have the best manners and character." - Prophet Muhammad (peace be upon him)

Today I reflected on how our character is our most valuable asset. It's not just about rituals but how we treat others in our daily interactions.`,
                    time: '2 hours ago',
                    likes: 245,
                    comments: 47,
                    liked: false,
                    commentsList: [
                        { 
                            id: 1, 
                            user: 'Maryam Khan', 
                            avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'Beautiful reminder! JazakAllah khair', 
                            time: '1 hour ago',
                            likes: 12,
                            liked: false
                        },
                        { 
                            id: 2, 
                            user: 'Omar Farooq', 
                            avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'Character is indeed everything in Islam', 
                            time: '45 mins ago',
                            likes: 8,
                            liked: true
                        }
                    ]
                },
                {
                    id: 2,
                    content: `Just completed my morning Adhkar and felt such peace. The remembrance of Allah truly brings tranquility to the heart.

Morning routine:
1. Fajr prayer
2. Morning Adhkar
3. Quran recitation
4. Planning the day with gratitude`,
                    time: '1 day ago',
                    likes: 189,
                    comments: 32,
                    liked: true,
                    commentsList: [
                        { 
                            id: 1, 
                            user: 'Fatima Ahmed', 
                            avatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'May Allah accept your efforts!', 
                            time: '22 hours ago',
                            likes: 5,
                            liked: false
                        },
                        { 
                            id: 2, 
                            user: 'Yusuf Islam', 
                            avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'I need to start this routine too', 
                            time: '20 hours ago',
                            likes: 3,
                            liked: false
                        }
                    ]
                },
                {
                    id: 3,
                    content: `The importance of sincerity (Ikhlas) in our actions cannot be overstated. The Prophet (ï·º) said: "Actions are judged by intentions, and every person will have what they intended." (Bukhari & Muslim)

Always check your intentions before any act of worship or good deed.`,
                    time: '3 days ago',
                    likes: 312,
                    comments: 54,
                    liked: false,
                    commentsList: [
                        { 
                            id: 1, 
                            user: 'Abdullah Rahman', 
                            avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'This hadith changed my life', 
                            time: '2 days ago',
                            likes: 15,
                            liked: false
                        },
                        { 
                            id: 2, 
                            user: 'Aisha Malik', 
                            avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80', 
                            text: 'Such an important reminder!', 
                            time: '1 day ago',
                            likes: 9,
                            liked: true
                        }
                    ]
                }
            ],
            checkedInToday: false
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================

        // Page elements
        const backBtn = document.getElementById('backBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const editProfileImageBtn = document.getElementById('editProfileImageBtn');
        const editProfileTextBtn = document.getElementById('editProfileTextBtn');
        const shareProfileBtn = document.getElementById('shareProfileBtn');
        const checkinBtn = document.getElementById('checkinBtn');
        const donateBtn = document.getElementById('donateBtn');
        const textPosts = document.getElementById('textPosts');
        
        // Modal elements
        const dailyCheckinModal = document.getElementById('dailyCheckinModal');
        const claimDailyRewardBtn = document.getElementById('claimDailyRewardBtn');
        
        // Edit Profile Modal elements
        const editProfileModalOverlay = document.getElementById('editProfileModalOverlay');
        const editProfileModalClose = document.getElementById('editProfileModalClose');
        const editProfileForm = document.getElementById('editProfileForm');
        const editNameInput = document.getElementById('editName');
        const editUsernameInput = document.getElementById('editUsername');
        const editBioTextarea = document.getElementById('editBio');
        const hideCharityBalanceCheckbox = document.getElementById('hideCharityBalance');
        const privateAccountCheckbox = document.getElementById('privateAccount');
        const cancelEditProfileBtn = document.getElementById('cancelEditProfileBtn');
        const saveEditProfileBtn = document.getElementById('saveEditProfileBtn');
        const changePhotoBtn = document.getElementById('changePhotoBtn');
        
        // DeenPoints elements
        const deenpointsBalanceBtn = document.getElementById('deenpointsBalanceBtn');
        const userDeenPointsDisplay = document.getElementById('userDeenPoints');
        const purchaseModal = document.getElementById('purchaseModal');
        const closePurchaseModal = document.getElementById('closePurchaseModal');
        const cancelPurchaseBtn = document.getElementById('cancelPurchaseBtn');
        const confirmPurchaseBtn = document.getElementById('confirmPurchaseBtn');
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        const purchaseFormContent = document.getElementById('purchaseFormContent');
        const purchaseSuccessContent = document.getElementById('purchaseSuccessContent');
        const currentBalanceDisplay = document.getElementById('currentBalanceDisplay');
        const customDeenPointsInput = document.getElementById('customDeenPoints');
        const customCostDisplay = document.getElementById('customCostDisplay');
        const purchaseSuccessAmount = document.getElementById('purchaseSuccessAmount');
        const purchaseSuccessCost = document.getElementById('purchaseSuccessCost');
        const newBalance = document.getElementById('newBalance');

        // ============================================
        // INITIALIZATION
        // ============================================

        function initializeApp() {
            updateProfileUI();
            updateDeenPointsDisplay();
            renderPosts();
            setupPurchaseModal();
            setupEventListeners();
            // FIXED: Call checkCheckinStatus to set initial state
            checkCheckinStatus();
        }

        // ============================================
        // PROFILE FUNCTIONS
        // ============================================

        function updateProfileUI() {
            document.querySelector('.profile-name').textContent = state.user.name;
            document.querySelector('.profile-username').textContent = state.user.username;
            document.querySelector('.profile-bio').innerHTML = `<i class="fas fa-quote-left"></i> ${state.user.bio} <i class="fas fa-quote-right"></i>`;
            
            document.querySelector('.stat-item.posts .stat-value').textContent = state.user.posts;
            document.querySelector('.stat-item.followers .stat-value').textContent = state.user.followers;
            document.querySelector('.stat-item.following .stat-value').textContent = state.user.following;
            document.querySelector('.stat-item.donations .stat-value').textContent = `$${state.user.donations}`;
        }

        function updateDeenPointsDisplay() {
            userDeenPointsDisplay.textContent = state.user.deenpoints;
            if (currentBalanceDisplay) {
                currentBalanceDisplay.textContent = state.user.deenpoints;
            }
        }

        // ============================================
        // FIXED: POSTS WITH USER INFO (Only photo and username)
        // ============================================

        function renderPosts() {
            textPosts.innerHTML = '';
            
            state.posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'text-post-card';
                postElement.setAttribute('data-post', post.id);
                
                const likeClass = post.liked ? 'post-stat liked' : 'post-stat';
                const likeIcon = post.liked ? 'fas fa-heart' : 'far fa-heart';
                
                // Render comments with like buttons
                const commentsHTML = post.commentsList.map(comment => {
                    const commentLikeClass = comment.liked ? 'comment-like liked' : 'comment-like';
                    const commentLikeIcon = comment.liked ? 'fas fa-heart' : 'far fa-heart';
                    
                    return `
                        <div class="comment" data-post="${post.id}" data-comment="${comment.id}">
                            <img src="${comment.avatar}" alt="${comment.user}" class="comment-avatar">
                            <div class="comment-content">
                                <div class="comment-author">${comment.user}</div>
                                <div class="comment-text">${comment.text}</div>
                                <div class="comment-footer">
                                    <div class="comment-time">${comment.time}</div>
                                    <div class="${commentLikeClass}" data-post="${post.id}" data-comment="${comment.id}">
                                        <i class="${commentLikeIcon}"></i>
                                        <span class="comment-like-count">${comment.likes}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <img src="${state.user.profileImage}" alt="Profile" class="post-user-avatar">
                        <div class="post-user-info">
                            <div class="post-user-name">${state.user.name}</div>
                            <div class="post-user-username">${state.user.username}</div>
                        </div>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-meta">
                        <div class="post-time">${post.time}</div>
                        <div class="post-stats">
                            <div class="${likeClass}" data-post="${post.id}" data-action="like">
                                <i class="${likeIcon}"></i>
                                <span class="like-count">${post.likes}</span>
                            </div>
                            <div class="post-stat" data-post="${post.id}" data-action="comment">
                                <i class="far fa-comment"></i>
                                <span>${post.comments}</span>
                            </div>
                        </div>
                    </div>
                    <div class="comments-section" id="comments-${post.id}">
                        ${commentsHTML}
                        <div class="add-comment">
                            <input type="text" class="comment-input" placeholder="Add a comment..." data-post="${post.id}">
                            <button class="send-comment-btn" data-post="${post.id}">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                textPosts.appendChild(postElement);
            });
        }

        // FIXED: No notification when liking/unliking
        function togglePostLike(postId) {
            const post = state.posts.find(p => p.id === postId);
            if (post) {
                post.liked = !post.liked;
                post.likes += post.liked ? 1 : -1;
                
                const likeElement = document.querySelector(`.post-stat[data-post="${postId}"][data-action="like"]`);
                if (likeElement) {
                    likeElement.classList.toggle('liked', post.liked);
                    likeElement.innerHTML = `
                        <i class="${post.liked ? 'fas' : 'far'} fa-heart"></i>
                        <span class="like-count">${post.likes}</span>
                    `;
                }
                
                // NO NOTIFICATION - REMOVED
            }
        }

        // FIXED: No notification when liking/unliking comments
        function toggleCommentLike(postId, commentId) {
            const post = state.posts.find(p => p.id === postId);
            if (post) {
                const comment = post.commentsList.find(c => c.id === commentId);
                if (comment) {
                    comment.liked = !comment.liked;
                    comment.likes += comment.liked ? 1 : -1;
                    
                    const commentLikeElement = document.querySelector(`.comment-like[data-post="${postId}"][data-comment="${commentId}"]`);
                    if (commentLikeElement) {
                        commentLikeElement.classList.toggle('liked', comment.liked);
                        commentLikeElement.innerHTML = `
                            <i class="${comment.liked ? 'fas' : 'far'} fa-heart"></i>
                            <span class="comment-like-count">${comment.likes}</span>
                        `;
                    }
                    
                    // NO NOTIFICATION - REMOVED
                }
            }
        }

        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection) {
                commentsSection.classList.toggle('active');
            }
        }

        function addComment(postId, commentText) {
            const post = state.posts.find(p => p.id === postId);
            if (post && commentText.trim()) {
                const newComment = {
                    id: post.commentsList.length + 1,
                    user: 'You',
                    avatar: state.user.profileImage,
                    text: commentText,
                    time: 'Just now',
                    likes: 0,
                    liked: false
                };
                
                post.commentsList.push(newComment);
                post.comments += 1;
                
                // Update UI
                const commentsSection = document.getElementById(`comments-${postId}`);
                if (commentsSection) {
                    const newCommentElement = document.createElement('div');
                    newCommentElement.className = 'comment';
                    newCommentElement.setAttribute('data-post', postId);
                    newCommentElement.setAttribute('data-comment', newComment.id);
                    newCommentElement.innerHTML = `
                        <img src="${newComment.avatar}" alt="${newComment.user}" class="comment-avatar">
                        <div class="comment-content">
                            <div class="comment-author">${newComment.user}</div>
                            <div class="comment-text">${newComment.text}</div>
                            <div class="comment-footer">
                                <div class="comment-time">${newComment.time}</div>
                                <div class="comment-like" data-post="${postId}" data-comment="${newComment.id}">
                                    <i class="far fa-heart"></i>
                                    <span class="comment-like-count">${newComment.likes}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    commentsSection.insertBefore(newCommentElement, commentsSection.querySelector('.add-comment'));
                    
                    // Update comment count
                    const commentStat = document.querySelector(`.post-stat[data-post="${postId}"][data-action="comment"] span`);
                    if (commentStat) {
                        commentStat.textContent = post.comments;
                    }
                }
                
                showNotification('Comment added!');
            }
        }

        // ============================================
        // FIXED: DAILY CHECK-IN FUNCTIONALITY - Now working properly
        // ============================================

        function checkCheckinStatus() {
            const today = new Date().toDateString();
            const lastCheckin = localStorage.getItem('lastDailyCheckin');
            
            // FIXED: Check if user has already checked in today
            if (lastCheckin === today) {
                // User has already checked in today
                checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>Checked In</span>';
                checkinBtn.classList.remove('checkin');
                checkinBtn.classList.add('checked-in');
                checkinBtn.disabled = true;
                state.checkedInToday = true;
            } else {
                // User hasn't checked in today - show "Check In" button
                checkinBtn.innerHTML = '<i class="fas fa-calendar-check"></i><span>Check In</span>';
                checkinBtn.classList.remove('checked-in');
                checkinBtn.classList.add('checkin');
                checkinBtn.disabled = false;
                state.checkedInToday = false;
            }
        }

        function claimDailyReward() {
            state.user.deenpoints += 5;
            updateDeenPointsDisplay();
            
            // Mark today as checked in
            localStorage.setItem('lastDailyCheckin', new Date().toDateString());
            
            dailyCheckinModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Update check-in button
            checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>Checked In</span>';
            checkinBtn.classList.remove('checkin');
            checkinBtn.classList.add('checked-in');
            checkinBtn.disabled = true;
            state.checkedInToday = true;
            
            showNotification('5 DeenPoints added! Daily check-in completed.');
        }

        // ============================================
        // FIXED: EDIT PROFILE MODAL - Now properly styled
        // ============================================

        function openEditProfileModal() {
            editNameInput.value = state.user.name;
            editUsernameInput.value = state.user.username;
            editBioTextarea.value = state.user.bio;
            hideCharityBalanceCheckbox.checked = state.user.hideCharityBalance;
            privateAccountCheckbox.checked = state.user.privateAccount;
            
            editProfileModalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeEditProfileModal() {
            editProfileModalOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function saveProfileChanges(profileData) {
            state.user.name = profileData.name;
            state.user.username = profileData.username;
            state.user.bio = profileData.bio;
            state.user.hideCharityBalance = profileData.hideCharityBalance;
            state.user.privateAccount = profileData.privateAccount;
            
            updateProfileUI();
            closeEditProfileModal();
            showNotification('Profile updated successfully!');
        }

        // ============================================
        // FIXED: SHARE PROFILE FUNCTIONALITY
        // ============================================

        function shareProfile() {
            if (navigator.share) {
                navigator.share({
                    title: `${state.user.name}'s Profile`,
                    text: `Check out ${state.user.name}'s profile on DeenLink!`,
                    url: window.location.href
                })
                .then(() => showNotification('Profile shared successfully!'))
                .catch(err => console.log('Error sharing:', err));
            } else {
                // Fallback: Copy to clipboard
                navigator.clipboard.writeText(window.location.href)
                    .then(() => showNotification('Profile link copied to clipboard!'))
                    .catch(err => console.log('Error copying:', err));
            }
        }

        // ============================================
        // NEW: DONATE BUTTON FUNCTIONALITY
        // ============================================

        function navigateToCharity() {
            showPageLoader();
            setTimeout(() => {
                window.location.href = '../Charity/index.html';
            }, 300);
        }

        // ============================================
        // FIXED: DEENPOINTS PURCHASE MODAL (COMPLETE VERSION)
        // ============================================

        function openPurchaseModal() {
            currentBalanceDisplay.textContent = state.user.deenpoints;
            
            purchaseFormContent.style.display = 'block';
            purchaseSuccessContent.style.display = 'none';
            
            document.querySelectorAll('.purchase-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            customDeenPointsInput.value = '';
            customCostDisplay.textContent = 'â‚¦0.00';
            
            purchaseModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePurchaseModalFunc() {
            purchaseModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function showPurchaseSuccess(pointsAdded, cost) {
            purchaseSuccessAmount.innerHTML = `<img src="../img/deenPoints.png" alt="DeenPoints"> <span>${pointsAdded}</span>`;
            purchaseSuccessCost.textContent = `â‚¦${cost.toFixed(2)}`;
            newBalance.textContent = state.user.deenpoints;
            
            purchaseFormContent.style.display = 'none';
            purchaseSuccessContent.style.display = 'block';
        }

        function confirmPurchase() {
            let pointsToAdd = 0;
            let cost = 0;
            
            const selectedOption = document.querySelector('.purchase-option:not(.custom-purchase).selected');
            if (selectedOption) {
                pointsToAdd = parseInt(selectedOption.dataset.points);
                cost = parseInt(selectedOption.dataset.cost);
            } 
            else if (customDeenPointsInput.value) {
                pointsToAdd = parseInt(customDeenPointsInput.value);
                cost = pointsToAdd * 1.5;
            }
            
            if (pointsToAdd <= 0) {
                showNotification("Please select a purchase option or enter a custom amount.");
                return;
            }
            
            state.user.deenpoints += pointsToAdd;
            updateDeenPointsDisplay();
            
            // Simulate processing
            confirmPurchaseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            confirmPurchaseBtn.disabled = true;
            
            setTimeout(() => {
                confirmPurchaseBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Purchase';
                confirmPurchaseBtn.disabled = false;
                
                showPurchaseSuccess(pointsToAdd, cost);
                showNotification(`${pointsToAdd} DeenPoints added to your account!`);
            }, 1000);
        }

        function setupPurchaseModal() {
            const purchaseOptions = document.querySelectorAll('.purchase-option:not(.custom-purchase)');
            
            purchaseOptions.forEach(option => {
                option.addEventListener('click', function() {
                    purchaseOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    customDeenPointsInput.value = '';
                    customCostDisplay.textContent = 'â‚¦0.00';
                });
            });
            
            customDeenPointsInput.addEventListener('input', function() {
                const points = parseInt(this.value) || 0;
                const cost = points * 1.5;
                
                if (points > 0) {
                    document.querySelectorAll('.purchase-option:not(.custom-purchase)').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                }
                
                customCostDisplay.textContent = `â‚¦${cost.toFixed(2)}`;
            });
            
            closePurchaseModal.addEventListener('click', closePurchaseModalFunc);
            cancelPurchaseBtn.addEventListener('click', closePurchaseModalFunc);
            closeSuccessBtn.addEventListener('click', closePurchaseModalFunc);
            confirmPurchaseBtn.addEventListener('click', confirmPurchase);
            
            // Close modal when clicking outside
            purchaseModal.addEventListener('click', function(event) {
                if (event.target === purchaseModal) {
                    closePurchaseModalFunc();
                }
            });
            
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && purchaseModal.classList.contains('active')) {
                    closePurchaseModalFunc();
                }
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        function setupEventListeners() {
            // Navigation
            backBtn.addEventListener('click', function() {
                showPageLoader();
                setTimeout(() => {
                    window.location.href = '../learning/index.html';
                }, 300);
            });

            // FIXED: Settings button navigates to settings.html
            settingsBtn.addEventListener('click', function() {
                showPageLoader();
                setTimeout(() => {
                    window.location.href = '../settings.html';
                }, 300);
            });

            // Profile actions
            editProfileImageBtn.addEventListener('click', openEditProfileModal);
            editProfileTextBtn.addEventListener('click', openEditProfileModal);
            shareProfileBtn.addEventListener('click', shareProfile);
            
            // NEW: Donate button navigates to Charity
            donateBtn.addEventListener('click', navigateToCharity);
            
            // FIXED: Check-in button opens modal (only if not checked in)
            checkinBtn.addEventListener('click', function() {
                if (!state.checkedInToday) {
                    dailyCheckinModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            });

            // Edit profile form
            editProfileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const profileData = {
                    name: editNameInput.value,
                    username: editUsernameInput.value,
                    bio: editBioTextarea.value,
                    hideCharityBalance: hideCharityBalanceCheckbox.checked,
                    privateAccount: privateAccountCheckbox.checked
                };
                
                saveProfileChanges(profileData);
            });

            changePhotoBtn.addEventListener('click', function() {
                showNotification('Photo upload will be implemented soon!');
            });

            cancelEditProfileBtn.addEventListener('click', closeEditProfileModal);
            editProfileModalClose.addEventListener('click', closeEditProfileModal);
            
            // Close edit profile modal when clicking outside
            editProfileModalOverlay.addEventListener('click', function(e) {
                if (e.target === editProfileModalOverlay) {
                    closeEditProfileModal();
                }
            });

            // DeenPoints
            deenpointsBalanceBtn.addEventListener('click', openPurchaseModal);

            // Daily check-in
            claimDailyRewardBtn.addEventListener('click', claimDailyReward);
            
            // Close daily check-in modal when clicking outside
            dailyCheckinModal.addEventListener('click', function(e) {
                if (e.target === dailyCheckinModal) {
                    dailyCheckinModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            // Post interactions
            document.addEventListener('click', function(e) {
                // Like button for posts
                if (e.target.closest('.post-stat[data-action="like"]')) {
                    const likeElement = e.target.closest('.post-stat');
                    const postId = parseInt(likeElement.getAttribute('data-post'));
                    togglePostLike(postId);
                }
                
                // Like button for comments
                if (e.target.closest('.comment-like')) {
                    const likeElement = e.target.closest('.comment-like');
                    const postId = parseInt(likeElement.getAttribute('data-post'));
                    const commentId = parseInt(likeElement.getAttribute('data-comment'));
                    toggleCommentLike(postId, commentId);
                }
                
                // Comment button for posts
                if (e.target.closest('.post-stat[data-action="comment"]')) {
                    const commentElement = e.target.closest('.post-stat');
                    const postId = parseInt(commentElement.getAttribute('data-post'));
                    toggleComments(postId);
                }
                
                // Send comment
                if (e.target.closest('.send-comment-btn')) {
                    const button = e.target.closest('.send-comment-btn');
                    const postId = parseInt(button.getAttribute('data-post'));
                    const input = document.querySelector(`.comment-input[data-post="${postId}"]`);
                    
                    if (input && input.value.trim()) {
                        addComment(postId, input.value.trim());
                        input.value = '';
                    }
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Close modals with Escape
                if (e.key === 'Escape') {
                    if (editProfileModalOverlay.classList.contains('active')) {
                        closeEditProfileModal();
                    }
                    if (purchaseModal.classList.contains('active')) {
                        closePurchaseModalFunc();
                    }
                    if (dailyCheckinModal.classList.contains('active')) {
                        dailyCheckinModal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                }
                
                // Submit comment with Enter
                if (e.key === 'Enter' && e.target.classList.contains('comment-input')) {
                    const postId = parseInt(e.target.getAttribute('data-post'));
                    if (e.target.value.trim()) {
                        addComment(postId, e.target.value.trim());
                        e.target.value = '';
                    }
                }
            });
        }

        // ============================================
        // NOTIFICATION FUNCTION
        // ============================================

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: var(--primary-green);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                font-weight: 500;
                animation: slideIn 0.3s ease, slideOut 0.3s ease 2s forwards;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 2500);
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        // ============================================
        // PAGE TRANSITION HANDLER
        // ============================================

        // Hide loader when page is fully loaded
        window.addEventListener('load', function() {
            hidePageLoader();
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function() {
            showPageLoader();
        });

    </script>
</body>
</html>