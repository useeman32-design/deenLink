<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic App | Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary-green: #1D6F42;
            --light-green: #E8F5E9;
            --accent-gold: #D4AF37;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #E0E0E0;
            --dark-gray: #757575;
            --text-dark: #333333;
            
            /* Quick Access Card Colors */
            --dua-light: #E8F5E9;
            --dua-dark: #C8E6C9;
            --athkar-light: #F3E5F5;
            --athkar-dark: #E1BEE7;
            --askquestion-light: #E3F2FD;
            --askquestion-dark: #BBDEFB;
            --deenai-light: #FFF8E1;
            --deenai-dark: #FFECB3;
            --wallpaper-light: #E1F5FE;
            --wallpaper-dark: #B3E5FC;
            --donation-light: #FFE5E5;
            --donation-dark: #FFB3B3;
            --tasbih-light: #E0F2F1;
            --tasbih-dark: #B2DFDB;
            --calendar-light: #FFF3E0;
            --calendar-dark: #FFCC80;
            --hadith-light: #FCE4EC;
            --hadith-dark: #F8BBD0;
            --quran-light: #E8F5E9;
            --quran-dark: #C8E6C9;
            --names-light: #F3E5F5;
            --names-dark: #E1BEE7;
            --quiz-light: #E0F7FA;
            --quiz-dark: #80DEEA;
            --addpost-light: #F1F8E9;
            --addpost-dark: #DCEDC8;
        }

        /* Dark Theme Variables */
        .dark-theme {
            --primary-green: #2ecc71;
            --light-green: #1a2526;
            --accent-gold: #f39c12;
            --white: #2c3e50;
            --light-gray: #34495e;
            --medium-gray: #4a6572;
            --dark-gray: #bdc3c7;
            --text-dark: #ecf0f1;
        }

        body {
            background-color: var(--light-gray);
            color: var(--text-dark);
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Page Loader Overlay - Fixed to cover entire screen */
        #pageLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #pageLoader.active {
            display: flex;
            opacity: 1;
        }

        /* Islamic Loader - Same as Quran Page */
        .islamic-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
        }

        .loader-crescent {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .crescent {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-gold));
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            animation: crescentFloat 3s ease-in-out infinite;
        }

        .crescent::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 50%;
        }

        .loader-star {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--accent-gold);
            font-size: 24px;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        .loader-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1px;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes crescentFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        @keyframes starTwinkle {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        @keyframes textPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Fade in animation for page content */
        .page-content {
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
            animation-delay: 0.1s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            padding: 0;
        }

        @media (min-width: 480px) {
            .container {
                max-width: 480px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
            }
        }

        /* Page Transition Overlay - Same as Quran Page */
        .page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page-transition-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* Top Section - FIXED HEADER LAYOUT */
        .top-section {
            height: 240px;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 100%;
        }

        @media (min-width: 768px) {
            .top-section {
                height: 280px;
                border-radius: 0;
            }
        }

        @media (min-width: 1024px) {
            .top-section {
                height: 300px;
            }
        }

        .background-carousel {
            display: flex;
            width: 300%;
            height: 100%;
            transition: transform 0.8s ease-in-out;
        }

        .carousel-slide {
            width: 100%;
            height: 100%;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        @media (min-width: 768px) {
            .carousel-slide {
                background-size: cover;
                background-position: center;
            }
        }

        .slide-1 {
            background-image: linear-gradient(rgba(29, 111, 66, 0.85), rgba(29, 111, 66, 0.9)), url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1600&q=80');
        }

        .slide-2 {
            background-image: linear-gradient(rgba(29, 111, 66, 0.85), rgba(29, 111, 66, 0.9)), url('https://images.unsplash.com/photo-1632192759639-009dda6d8d03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1600&q=80');
        }

        .slide-3 {
            background-image: linear-gradient(rgba(29, 111, 66, 0.85), rgba(29, 111, 66, 0.9)), url('https://images.unsplash.com/photo-1622737133809-d95047b9e673?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1600&q=80');
        }

        .carousel-indicators {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .indicator.active {
            background-color: var(--white);
        }

        /* FIXED: Top Bar Layout - Better spacing for mobile */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            z-index: 10;
            gap: 10px;
            flex-wrap: nowrap;
        }

        @media (min-width: 768px) {
            .top-bar {
                padding: 20px 30px;
                gap: 20px;
            }
        }

        /* Location Button - Fixed size and text overflow */
        .location-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            backdrop-filter: blur(5px);
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
            min-width: 80px;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .location-btn {
                max-width: 150px;
                font-size: 14px;
                padding: 8px 16px;
            }
        }

        .location-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* Messages Button - Better positioning */
        .messages-btn {
            position: relative;
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border: none;
            padding: 8px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            backdrop-filter: blur(5px);
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            min-width: 36px;
            height: 36px;
        }

        @media (min-width: 768px) {
            .messages-btn {
                padding: 8px 12px;
                min-width: auto;
                height: auto;
            }
        }

        .messages-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .message-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            font-size: 10px;
            font-weight: bold;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }

        /* Date Info - Fixed text alignment and sizing */
        .date-info {
            text-align: right;
            color: var(--white);
            flex: 1;
            min-width: 0;
            margin: 0 10px;
        }

        @media (min-width: 768px) {
            .date-info {
                margin: 0 20px;
            }
        }

        .islamic-date {
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .islamic-date {
                font-size: 14px;
            }
        }

        .gregorian-date {
            font-size: 11px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .gregorian-date {
                font-size: 12px;
            }
        }

        /* Search Container - Better spacing */
        .search-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .search-container {
                gap: 10px;
            }
        }

        .search-btn {
            background: none;
            border: none;
            color: var(--white);
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 36px;
            height: 36px;
        }

        @media (min-width: 768px) {
            .search-btn {
                font-size: 18px;
                width: 40px;
                height: 40px;
            }
        }

        .search-btn:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .search-input-container {
            display: none;
            position: absolute;
            top: 70px;
            right: 16px;
            left: 16px;
            z-index: 100;
        }

        @media (min-width: 768px) {
            .search-input-container {
                right: 30px;
                left: 30px;
                top: 80px;
            }
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            background-color: rgba(255, 255, 255, 0.95);
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            outline: none;
        }

        .search-input.active {
            display: block;
        }

        .prayer-timer {
            position: absolute;
            bottom: 50px;
            left: 0;
            right: 0;
            text-align: center;
            color: var(--white);
            padding: 0 16px;
        }

        @media (min-width: 768px) {
            .prayer-timer {
                bottom: 60px;
                padding: 0 30px;
            }
        }

        .next-prayer {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .next-prayer {
                font-size: 18px;
            }
        }

        .countdown-timer {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @media (min-width: 768px) {
            .countdown-timer {
                font-size: 32px;
            }
        }

        /* City Change Modal */
        .city-change-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .city-change-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .city-change-content {
            background-color: var(--white);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .city-change-icon {
            font-size: 48px;
            color: var(--primary-green);
            margin-bottom: 16px;
        }

        .city-change-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .city-name {
            color: var(--primary-green);
            font-weight: 700;
        }

        .city-change-text {
            font-size: 15px;
            color: var(--dark-gray);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .city-change-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .city-change-btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            max-width: 150px;
        }

        .city-change-btn.cancel {
            background-color: var(--light-gray);
            color: var(--text-dark);
        }

        .city-change-btn.cancel:hover {
            background-color: var(--medium-gray);
        }

        .city-change-btn.confirm {
            background-color: var(--primary-green);
            color: white;
        }

        .city-change-btn.confirm:hover {
            background-color: #155c35;
        }

        /* Quick Buttons Section */
        .quick-buttons-section {
            padding: 20px 16px 0;
            margin-bottom: 16px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .quick-buttons-section {
                padding: 30px 30px 0;
            }
            
            .quick-buttons-container {
                justify-content: center;
                flex-wrap: wrap;
                overflow-x: visible;
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .quick-buttons-container {
                gap: 25px;
            }
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 20px;
                padding-left: 0;
                text-align: left;
            }
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--text-dark);
            font-size: 14px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 20px;
            background-color: var(--medium-gray);
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: var(--dark-gray);
        }

        .theme-toggle i {
            font-size: 16px;
        }

        .quick-buttons-container {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding-bottom: 8px;
            scrollbar-width: thin;
            scrollbar-color: var(--medium-gray) transparent;
            width: 100%;
        }

        .quick-buttons-container::-webkit-scrollbar {
            height: 4px;
        }

        .quick-buttons-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .quick-buttons-container::-webkit-scrollbar-thumb {
            background-color: var(--medium-gray);
            border-radius: 10px;
        }

        /* Quick Access Button Styles */
        .quick-button.dua {
            background: linear-gradient(135deg, var(--dua-light), var(--dua-dark));
        }
        .quick-button.athkar {
            background: linear-gradient(135deg, var(--athkar-light), var(--athkar-dark));
        }
        .quick-button.askquestion {
            background: linear-gradient(135deg, var(--askquestion-light), var(--askquestion-dark));
        }
        .quick-button.addpost {
            background: linear-gradient(135deg, var(--addpost-light), var(--addpost-dark));
        }
        .quick-button.deenai {
            background: linear-gradient(135deg, var(--deenai-light), var(--deenai-dark));
        }
        .quick-button.wallpaper {
            background: linear-gradient(135deg, var(--wallpaper-light), var(--wallpaper-dark));
        }
        .quick-button.donation {
            background: linear-gradient(135deg, var(--donation-light), var(--donation-dark));
        }
        .quick-button.tasbih {
            background: linear-gradient(135deg, var(--tasbih-light), var(--tasbih-dark));
        }
        .quick-button.calendar {
            background: linear-gradient(135deg, var(--calendar-light), var(--calendar-dark));
        }
        .quick-button.hadith {
            background: linear-gradient(135deg, var(--hadith-light), var(--hadith-dark));
        }
        .quick-button.quran {
            background: linear-gradient(135deg, var(--quran-light), var(--quran-dark));
        }
        .quick-button.names {
            background: linear-gradient(135deg, var(--names-light), var(--names-dark));
        }
        .quick-button.quiz {
            background: linear-gradient(135deg, var(--quiz-light), var(--quiz-dark));
        }

        /* Enhanced Quick Button Styling - Remove underline from links */
        .quick-button {
            min-width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
            padding: 12px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            flex-shrink: 0;
            border: 2px solid transparent;
            text-decoration: none !important; /* Remove underline */
            color: inherit;
        }

        .quick-button:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            text-decoration: none !important;
        }

        .quick-button i {
            font-size: 28px;
            margin-bottom: 10px;
            transition: transform 0.3s;
        }

        .quick-button:hover i {
            transform: scale(1.2);
        }

        .quick-button-label {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            color: #000000 !important;
            transition: transform 0.3s;
            text-decoration: none !important;
        }

        .quick-button:hover .quick-button-label {
            transform: translateY(2px);
            text-decoration: none !important;
        }

        @media (min-width: 768px) {
            .quick-button {
                min-width: 110px;
                height: 110px;
            }
        }

        /* Add Post Modal */
        .add-post-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .add-post-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .add-post-content {
            background-color: var(--white);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .add-post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .add-post-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .add-post-close {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--dark-gray);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .add-post-close:hover {
            background-color: var(--light-gray);
        }

        .add-post-textarea {
            width: 100%;
            min-height: 150px;
            padding: 16px;
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            font-size: 15px;
            color: var(--text-dark);
            background-color: var(--white);
            resize: vertical;
            margin-bottom: 20px;
            outline: none;
            transition: border-color 0.3s;
        }

        .add-post-textarea:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(29, 111, 66, 0.1);
        }

        .add-post-textarea::placeholder {
            color: var(--dark-gray);
        }

        .add-post-actions {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .add-image-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            color: var(--text-dark);
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-image-btn:hover {
            background-color: var(--medium-gray);
        }

        .add-image-btn i {
            font-size: 18px;
            color: var(--primary-green);
        }

        .image-preview-container {
            display: none;
            position: relative;
            margin-bottom: 16px;
        }

        .image-preview-container.active {
            display: block;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 12px;
        }

        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .add-post-submit {
            padding: 14px;
            background-color: var(--primary-green);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-post-submit:hover {
            background-color: #155c35;
        }

        .add-post-submit:disabled {
            background-color: var(--medium-gray);
            cursor: not-allowed;
        }

        /* Digital Tasbeeh Modal */
        .tasbeeh-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .tasbeeh-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .tasbeeh-content {
            background-color: var(--white);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        .tasbeeh-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .tasbeeh-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tasbeeh-title i {
            color: var(--primary-green);
        }

        .tasbeeh-close {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--dark-gray);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .tasbeeh-close:hover {
            background-color: var(--light-gray);
        }

        .tasbeeh-counter {
            font-size: 72px;
            font-weight: 700;
            color: var(--primary-green);
            margin: 30px 0;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-family: 'Poppins', sans-serif;
        }

        .tasbeeh-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), #4CAF50);
            color: white;
            border: none;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(29, 111, 66, 0.3);
            transition: all 0.2s;
            user-select: none;
        }

        .tasbeeh-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 15px rgba(29, 111, 66, 0.4);
        }

        .tasbeeh-reset {
            padding: 12px 24px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
        }

        .tasbeeh-reset:hover {
            background-color: #d32f2f;
        }

        .tasbeeh-presets {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .tasbeeh-preset-btn {
            padding: 8px 16px;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tasbeeh-preset-btn:hover {
            background-color: var(--medium-gray);
        }

        .tasbeeh-preset-btn.active {
            background-color: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        /* Feed Tabs */
        .feed-tabs {
            display: flex;
            background-color: var(--white);
            border-bottom: 1px solid var(--medium-gray);
            padding: 0 16px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .feed-tabs {
                padding: 0 30px;
            }
        }

        .feed-tab {
            flex: 1;
            text-align: center;
            padding: 16px 0;
            font-weight: 500;
            color: var(--dark-gray);
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }

        .feed-tab:hover {
            color: var(--primary-green);
        }

        .feed-tab.active {
            color: var(--primary-green);
        }

        .feed-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--primary-green);
            border-radius: 3px 3px 0 0;
        }

        /* Daily Videos Section - Height reduced by 8% */
        .daily-videos-section {
            padding: 12px 16px; /* Reduced padding to reduce height */
            display: none;
            margin-bottom: 8px; /* Reduced margin */
            width: 100%;
        }

        @media (min-width: 768px) {
            .daily-videos-section {
                padding: 12px 30px; /* Reduced padding */
                margin-bottom: 12px; /* Reduced margin */
            }
        }

        .daily-videos-section.active {
            display: block;
        }

        .videos-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px; /* Reduced from 15px */
            padding-left: 0;
        }

        @media (min-width: 768px) {
            .videos-title {
                font-size: 20px;
                margin-bottom: 16px; /* Reduced from 20px */
            }
        }

        .videos-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 5px 5px 12px 5px; /* Reduced bottom padding */
            scrollbar-width: thin;
            scrollbar-color: var(--medium-gray) transparent;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        @media (min-width: 768px) {
            .videos-container {
                gap: 13px;
                padding: 5px 5px 15px 5px; /* Reduced bottom padding */
            }
        }

        .videos-container::-webkit-scrollbar {
            height: 6px;
        }

        .videos-container::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }

        .videos-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-green);
            border-radius: 10px;
        }

        .videos-container::-webkit-scrollbar-thumb:hover {
            background-color: #155c35;
        }

        /* Video Card Size - Height reduced */
        .video-card {
            min-width: 179px;
            width: 179px;
            aspect-ratio: 1 / 1.28; /* Reduced from 1 / 1.4 (8% height reduction) */
            background-color: var(--white);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .video-card {
                min-width: 205px;
                width: 205px;
                aspect-ratio: 1 / 1.24; /* Reduced from 1 / 1.35 (8% height reduction) */
            }
        }

        .video-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .video-thumbnail {
            width: 100%;
            height: 52%; /* Reduced from 55% */
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: rgba(29, 111, 66, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
        }

        .play-button:hover {
            background-color: rgba(29, 111, 66, 1);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .video-info {
            padding: 10px;
            height: 48%; /* Increased from 45% */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .video-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: var(--text-dark);
            word-wrap: break-word;
            overflow-wrap: break-word;
            min-height: 42px; /* Reduced from 46px */
        }

        @media (min-width: 768px) {
            .video-title {
                font-size: 13px;
                min-height: 48px; /* Reduced from 52px */
            }
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .video-uploader {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            color: var(--dark-gray);
            white-space: nowrap;
        }

        .video-uploader i {
            font-size: 10px;
        }

        .video-stats {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: var(--dark-gray);
        }

        .video-stat {
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
        }

        /* Fixed emoji icons */
        .video-stat i,
        .video-uploader i {
            font-size: 10px;
            min-width: 10px;
        }

        /* Video duration badge */
        .video-duration {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 500;
        }

        /* Video Modal with Download Button */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .video-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .video-modal-content {
            width: 100%;
            max-width: 900px;
            background-color: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .video-player {
            width: 100%;
            height: 350px;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        @media (min-width: 768px) {
            .video-player {
                height: 450px;
            }
        }

        .video-player-placeholder {
            color: white;
            text-align: center;
            padding: 30px;
        }

        .video-player-placeholder i {
            font-size: 70px;
            margin-bottom: 25px;
            color: var(--primary-green);
        }

        .video-player-placeholder h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .video-player-placeholder p {
            font-size: 16px;
            opacity: 0.8;
        }

        .close-video-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 45px;
            height: 45px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            cursor: pointer;
            border: none;
            z-index: 10;
            transition: all 0.3s;
        }

        .close-video-btn:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        /* Download Video Button */
        .download-video-btn {
            position: absolute;
            top: 20px;
            right: 75px;
            width: 45px;
            height: 45px;
            background-color: rgba(29, 111, 66, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            border: none;
            z-index: 10;
            transition: all 0.3s;
        }

        .download-video-btn:hover {
            background-color: rgba(29, 111, 66, 1);
            transform: scale(1.1);
        }

        .download-video-btn.downloading {
            background-color: #f39c12;
            animation: pulseDownload 1s infinite;
        }

        .download-video-btn.downloading i {
            animation: spinDownload 1s linear infinite;
        }

        .download-video-btn.completed {
            background-color: #27ae60;
        }

        @keyframes pulseDownload {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        @keyframes spinDownload {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .video-modal-info {
            padding: 20px;
        }

        .video-modal-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-dark);
            line-height: 1.4;
        }

        .video-modal-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .video-modal-uploader {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            color: var(--dark-gray);
        }

        .video-modal-uploader i {
            font-size: 20px;
        }

        .video-modal-stats {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 16px;
            color: var(--dark-gray);
        }

        /* Feed Cards */
        .feed-container {
            padding: 16px;
            padding-bottom: 100px;
            min-height: 400px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .feed-container {
                padding: 20px 30px 120px;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .feed-container {
                grid-template-columns: repeat(3, 1fr);
                max-width: 1200px;
                margin: 0 auto;
            }
        }

        .feed-card {
            background-color: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 16px;
            margin-bottom: 20px;
            transition: transform 0.3s;
            width: 100%;
        }

        @media (min-width: 768px) {
            .feed-card {
                margin-bottom: 0;
            }
        }

        .feed-card:hover {
            transform: translateY(-3px);
        }

        .feed-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .user-info {
            flex: 1;
        }

        .user-info h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .user-info p {
            font-size: 11px;
            color: var(--dark-gray);
        }

        .follow-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .follow-btn:hover {
            background-color: #155c35;
        }

        .follow-btn.following {
            background-color: var(--dark-gray);
        }

        .feed-content {
            margin-bottom: 16px;
            line-height: 1.5;
            font-size: 13px;
        }

        /* Feed Image Styling */
        .feed-image {
            width: 100%;
            border-radius: 12px;
            margin: 10px 0;
            display: block;
            max-height: 300px;
            object-fit: cover;
        }

        .feed-content img {
            width: 100%;
            border-radius: 12px;
            margin: 10px 0;
            display: block;
            max-height: 300px;
            object-fit: cover;
        }

        .feed-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--light-gray);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background: none;
            border: none;
            color: var(--dark-gray);
            font-size: 13px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .action-btn:hover {
            color: var(--primary-green);
        }

        .action-btn.liked {
            color: #e74c3c;
        }

        .action-btn.liked i {
            font-weight: 900;
        }

        .action-btn i {
            font-size: 14px;
        }

        .timestamp {
            font-size: 11px;
            color: var(--dark-gray);
        }

        /* Instagram-style Comment Section */
        .comment-section {
            margin-top: 16px;
            border-top: 1px solid var(--light-gray);
            padding-top: 16px;
            display: none;
        }

        .comment-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .comments-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 12px;
            padding-right: 5px;
        }

        .comments-list.large {
            max-height: 400px;
        }

        .comments-list::-webkit-scrollbar {
            width: 4px;
        }

        .comments-list::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }

        .comments-list::-webkit-scrollbar-thumb {
            background-color: var(--medium-gray);
            border-radius: 10px;
        }

        .comment-item {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .comment-user-pic {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-user-name {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 2px;
            display: inline-block;
        }

        .comment-text {
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 2px;
        }

        .comment-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .comment-time {
            font-size: 10px;
            color: var(--dark-gray);
        }

        .comment-like-btn {
            background: none;
            border: none;
            color: var(--dark-gray);
            font-size: 10px;
            cursor: pointer;
            padding: 0;
        }

        .comment-like-btn:hover {
            color: #e74c3c;
        }

        .comment-like-btn.liked {
            color: #e74c3c;
        }

        .add-comment {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--light-gray);
            position: relative;
        }

        .comment-input-container {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: var(--light-gray);
            border-radius: 18px;
            padding: 6px 12px;
        }

        .comment-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 12px;
            outline: none;
            color: var(--text-dark);
        }

        .comment-input::placeholder {
            color: var(--dark-gray);
        }

        .emoji-btn {
            background: none;
            border: none;
            color: var(--dark-gray);
            font-size: 14px;
            cursor: pointer;
            margin-left: 4px;
        }

        .emoji-picker {
            position: absolute;
            bottom: 45px;
            right: 0;
            background: var(--white);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 8px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            z-index: 100;
            max-width: 220px;
        }

        .emoji-picker.active {
            display: grid;
        }

        .emoji-option {
            font-size: 18px;
            cursor: pointer;
            text-align: center;
            padding: 4px;
            border-radius: 5px;
        }

        .emoji-option:hover {
            background-color: var(--light-gray);
        }

        .post-comment-btn {
            background: none;
            border: none;
            color: var(--primary-green);
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .post-comment-btn:hover {
            background-color: rgba(29, 111, 66, 0.1);
        }

        .post-comment-btn:disabled {
            color: var(--medium-gray);
            cursor: not-allowed;
        }

        /* Floating Action Button with Expansion */
        .floating-action-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(29, 111, 66, 0.5);
            border: none;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .floating-action-btn.active {
            background-color: #f39c12;
            transform: rotate(45deg);
        }

        @media (min-width: 768px) {
            .floating-action-btn {
                bottom: 100px;
                right: 30px;
                width: 70px;
                height: 70px;
            }
        }

        .floating-action-btn i {
            font-size: 24px;
        }

        /* Floating Action Menu */
        .floating-action-menu {
            position: fixed;
            bottom: 160px;
            right: 20px;
            z-index: 99;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .floating-action-menu.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        @media (min-width: 768px) {
            .floating-action-menu {
                bottom: 180px;
                right: 30px;
            }
        }

        .floating-menu-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--white);
            color: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        @media (min-width: 768px) {
            .floating-menu-item {
                width: 55px;
                height: 55px;
            }
        }

        .floating-menu-item:hover {
            transform: scale(1.1);
            background-color: var(--primary-green);
            color: var(--white);
        }

        .floating-menu-item i {
            font-size: 20px;
        }

        .floating-menu-label {
            position: absolute;
            right: 60px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            transform: translateX(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .floating-menu-item:hover .floating-menu-label {
            opacity: 1;
            transform: translateX(0);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            background-color: var(--white);
            box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.08);
            padding: 12px 0;
            z-index: 100;
            border-radius: 0;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                max-width: 768px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 20px 20px 0 0;
                margin-bottom: 10px;
            }
        }

        @media (min-width: 1024px) {
            .bottom-nav {
                max-width: 480px;
            }
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--dark-gray);
            text-decoration: none;
            transition: color 0.3s;
            cursor: pointer;
            padding: 5px 0;
            position: relative;
        }

        .nav-item:hover {
            color: var(--primary-green);
        }

        .nav-item.active {
            color: var(--primary-green);
        }

        .nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-align: center;
            line-height: 1.1;
        }

        /* Loader Animation */
        .nav-loader {
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: var(--primary-green);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .nav-item.loading .nav-loader {
            opacity: 1;
            animation: pulseLoader 1s infinite;
        }

        @keyframes pulseLoader {
            0%, 100% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scale(1.5);
                opacity: 0.7;
            }
        }

        .no-content-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--dark-gray);
            font-style: italic;
            grid-column: 1 / -1;
        }

        .no-content-message i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
            color: var(--medium-gray);
        }
    </style>
</head>
<body class="light-theme">
    <!-- Page Loader Overlay -->
    <div id="pageLoader">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Page Transition Overlay with Islamic Loader -->
    <div class="page-transition-overlay" id="pageTransitionOverlay">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- City Change Modal -->
    <div class="city-change-modal" id="cityChangeModal">
        <div class="city-change-content">
            <div class="city-change-icon">
                <i class="fas fa-location-dot"></i>
            </div>
            <h2 class="city-change-title">New City Detected</h2>
            <p class="city-change-text">We've detected you're in <span class="city-name" id="detectedCityName">Loading...</span>. Do you want to update your location and prayer times?</p>
            <div class="city-change-buttons">
                <button class="city-change-btn cancel" id="cancelCityChange">No, Keep Current</button>
                <button class="city-change-btn confirm" id="confirmCityChange">Yes, Update</button>
            </div>
        </div>
    </div>

    <!-- Add Post Modal -->
    <div class="add-post-modal" id="addPostModal">
        <div class="add-post-content">
            <div class="add-post-header">
                <div class="add-post-title">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create New Post</span>
                </div>
                <button class="add-post-close" id="addPostClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <textarea class="add-post-textarea" id="addPostText" placeholder="What's on your mind? Share something beneficial for the Deen..." rows="5"></textarea>
            
            <div class="image-preview-container" id="imagePreviewContainer">
                <img class="image-preview" id="imagePreview" src="" alt="Selected image">
                <button class="remove-image-btn" id="removeImageBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="add-post-actions">
                <button class="add-image-btn" id="addImageBtn">
                    <i class="fas fa-image"></i>
                    <span>Add Image</span>
                </button>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button class="add-post-submit" id="addPostSubmit" disabled>
                    <i class="fas fa-paper-plane"></i>
                    <span>Post</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Digital Tasbeeh Modal -->
    <div class="tasbeeh-modal" id="tasbeehModal">
        <div class="tasbeeh-content">
            <div class="tasbeeh-header">
                <div class="tasbeeh-title">
                    <i class="fas fa-circle-notch"></i>
                    <span>Digital Tasbeeh</span>
                </div>
                <button class="tasbeeh-close" id="tasbeehClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tasbeeh-counter" id="tasbeehCounter">0</div>
            <button class="tasbeeh-button" id="tasbeehButton">Tap</button>
            <button class="tasbeeh-reset" id="tasbeehReset">Reset</button>
            
            <div class="tasbeeh-presets">
                <button class="tasbeeh-preset-btn" data-count="33">SubhanAllah (33)</button>
                <button class="tasbeeh-preset-btn" data-count="33">Alhamdulillah (33)</button>
                <button class="tasbeeh-preset-btn" data-count="33">Allahu Akbar (33)</button>
                <button class="tasbeeh-preset-btn" data-count="100">Full Tasbeeh (100)</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-content" id="pageContent">
            <!-- Top Section with Background Carousel -->
            <section class="top-section">
                <div class="background-carousel" id="backgroundCarousel">
                    <div class="carousel-slide slide-1"></div>
                    <div class="carousel-slide slide-2"></div>
                    <div class="carousel-slide slide-3"></div>
                </div>
                
                <div class="carousel-indicators">
                    <div class="indicator active" data-slide="0"></div>
                    <div class="indicator" data-slide="1"></div>
                    <div class="indicator" data-slide="2"></div>
                </div>
                
                <!-- FIXED: Top Bar with better spacing -->
                <div class="top-bar">
                    <button class="location-btn" id="locationBtn">
                        <i class="fas fa-location-dot"></i> <span id="locationText">Loading...</span>
                    </button>
                    
                    <div class="date-info">
                        <div class="islamic-date" id="hijriDate">--</div>
                        <div class="gregorian-date" id="gregorianDate">--</div>
                        <div class="gregorian-date" style="font-size: 11px; margin-top: 2px;" id="nextPrayerTime">Next Prayer: Loading...</div>
                    </div>
                    
                    <div class="search-container">
                        <button class="search-btn" id="searchButton">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="messages-btn" id="messagesBtn">
                            <i class="fas fa-paper-plane"></i>
                            <span class="message-badge" id="messageBadge">3</span>
                        </button>
                    </div>
                </div>
                
                <div class="search-input-container" id="searchInputContainer">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search for duas, prayers, articles...">
                </div>
                
                <div class="prayer-timer">
                    <div class="next-prayer">
                        <i class="fas fa-clock"></i> Next Prayer: <span id="nextPrayerName">Loading...</span>
                    </div>
                    <div class="countdown-timer" id="countdownTimer">--:--:--</div>
                </div>
            </section>

            <!-- Quick Buttons Section -->
            <section class="quick-buttons-section">
                <div class="section-title">
                    <span>Quick Access</span>
                    <div>
                        <button class="theme-toggle" id="themeToggle">
                            <i class="fas fa-moon"></i>
                            <span>Dark</span>
                        </button>
                    </div>
                </div>
                <div class="quick-buttons-container">
                    <!-- Ask Question -->
                    <a href="Scholars/index.html" class="quick-button askquestion">
                        <i class="fas fa-question-circle" style="color: #1565C0;"></i>
                        <span class="quick-button-label">Ask Question</span>
                    </a>
                    
                    <!-- Dua -->
                    <a href="tools/dua.html" class="quick-button dua">
                        <i class="fas fa-hands-praying" style="color: #1D6F42;"></i>
                        <span class="quick-button-label">Dua</span>
                    </a>
                    
                    <!-- Athkar -->
                    <a href="tools/dua-reader.html?chapter=27" class="quick-button athkar">
                        <i class="fas fa-quran" style="color: #7B1FA2;"></i>
                        <span class="quick-button-label">Athkar</span>
                    </a>
                    
                    <!-- Add Post -->
                    <a href="#" class="quick-button addpost" id="quickAddPostBtn">
                        <i class="fas fa-plus-square" style="color: #43A047;"></i>
                        <span class="quick-button-label">Add Post</span>
                    </a>
                    
                    <!-- Deen AI -->
                    <a href="deenai.html" class="quick-button deenai">
                        <i class="fas fa-robot" style="color: #FF9800;"></i>
                        <span class="quick-button-label">Deen AI</span>
                    </a>
                    
                    <!-- Islamic Wallpapers -->
                    <a href="wallpapper/index.html" class="quick-button wallpaper">
                        <i class="fas fa-image" style="color: #0288D1;"></i>
                        <span class="quick-button-label">Islamic Wallpapers</span>
                    </a>
                    
                    <!-- Donation & Charity -->
                    <a href="Charity/index.html" class="quick-button donation">
                        <i class="fas fa-hand-holding-heart" style="color: #D32F2F;"></i>
                        <span class="quick-button-label">Donation & Charity</span>
                    </a>
                    
                    <!-- Tasbih -->
                    <a href="#" class="quick-button tasbih" id="quickTasbihBtn">
                        <i class="fas fa-circle-notch" style="color: #00796B;"></i>
                        <span class="quick-button-label">Tasbih</span>
                    </a>
                    
                    <!-- Calendar -->
                    <a href="tools/calender.html" class="quick-button calendar">
                        <i class="fas fa-calendar-days" style="color: #F57C00;"></i>
                        <span class="quick-button-label">Calendar</span>
                    </a>
                    
                    <!-- Hadith -->
                    <a href="quranHadith/hadith.html" class="quick-button hadith">
                        <i class="fas fa-book-open" style="color: #C2185B;"></i>
                        <span class="quick-button-label">Hadith</span>
                    </a>
                    
                    <!-- Quran -->
                    <a href="quranHadith/surah.html" class="quick-button quran">
                        <i class="fas fa-book-quran" style="color: #1D6F42;"></i>
                        <span class="quick-button-label">Quran</span>
                    </a>
                    
                    <!-- Names of Allah - FIXED: Changed from tool/99names.html to tools/99names.html -->
                    <a href="tools/99names.html" class="quick-button names">
                        <i class="fas fa-star-and-crescent" style="color: #303F9F;"></i>
                        <span class="quick-button-label">Names of Allah</span>
                    </a>
                    
                    <!-- Quiz -->
                    <a href="learning/quiz.html" class="quick-button quiz">
                        <i class="fas fa-brain" style="color: #0097A7;"></i>
                        <span class="quick-button-label">Quiz</span>
                    </a>
                </div>
            </section>

            <!-- Feed Tabs -->
            <div class="feed-tabs">
                <div class="feed-tab active" data-tab="for-you">For You</div>
                <div class="feed-tab" data-tab="following">Following</div>
                <div class="feed-tab" data-tab="scholars">Scholars</div>
            </div>

            <!-- Daily Videos Section (Only for For You tab) - HORIZONTAL SCROLLABLE -->
            <section class="daily-videos-section" id="dailyVideosSection">
                <h2 class="videos-title">Daily Videos by DeenLink</h2>
                <div class="videos-container">
                    <!-- Video 1 -->
                    <div class="video-card" data-video="1">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1512790182412-b19e6d62bc39?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">8:42</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">The Power of Dua: How to Make Your Prayers Accepted by Allah</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>12.5K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 2 -->
                    <div class="video-card" data-video="2">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1543163521-1bf539c55dd2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">15:23</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">Understanding the Last 10 Nights of Ramadan - Laylatul Qadr</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>8.7K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 3 -->
                    <div class="video-card" data-video="3">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">12:15</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">5 Daily Habits That Will Bring You Closer to Allah in Your Daily Life</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>21.3K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 4 -->
                    <div class="video-card" data-video="4">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">22:47</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">The Beautiful Story of Prophet Yusuf (AS) - Patience and Trust in Allah's Plan</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>34.8K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 5 -->
                    <div class="video-card" data-video="5">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1544364631-99bbd8e23f08?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">18:32</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">How to Perform Salah Correctly - Step by Step Guide for Beginners</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>45.2K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 6 (Extra) -->
                    <div class="video-card" data-video="6">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">14:20</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">The Importance of Sadaqah (Charity) in Islam - Rewards and Benefits</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>28.3K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video 7 (Extra) -->
                    <div class="video-card" data-video="7">
                        <div class="video-thumbnail">
                            <img src="https://images.unsplash.com/photo-1512790182412-b19e6d62bc39?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Video Thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">9:45</div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">Understanding Zakat - The Third Pillar of Islam Explained Simply</h3>
                            <div class="video-meta">
                                <div class="video-uploader">
                                    <i class="fas fa-user-circle"></i>
                                    <span>DeenLink</span>
                                </div>
                                <div class="video-stats">
                                    <div class="video-stat">
                                        <i class="far fa-eye"></i>
                                        <span>16.9K</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Video Modal with Download Button -->
            <div class="video-modal" id="videoModal">
                <div class="video-modal-content">
                    <button class="close-video-btn" id="closeVideoBtn">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="download-video-btn" id="downloadVideoBtn">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="video-player" id="videoPlayer">
                        <div class="video-player-placeholder">
                            <i class="fas fa-play-circle"></i>
                            <h3>Video Player</h3>
                            <p>In a real app, this would show the actual video player</p>
                        </div>
                    </div>
                    <div class="video-modal-info">
                        <h3 class="video-modal-title" id="videoModalTitle">Video Title</h3>
                        <div class="video-modal-meta">
                            <div class="video-modal-uploader">
                                <i class="fas fa-user-circle"></i>
                                <span>DeenLink</span>
                            </div>
                            <div class="video-modal-stats" id="videoModalStats">
                                <span><i class="far fa-eye"></i> 0 views</span>
                                <span><i class="far fa-clock"></i> 0:00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feed Cards -->
            <section class="feed-container" id="feedContainer">
                <!-- Content will be dynamically loaded based on active tab -->
            </section>

            <!-- Floating Action Button with Menu -->
            <button class="floating-action-btn" id="fabButton">
                <i class="fas fa-plus"></i>
            </button>

            <!-- Floating Action Menu -->
            <div class="floating-action-menu" id="fabMenu">
                <button class="floating-menu-item" id="addPostBtn">
                    <i class="fas fa-plus-square"></i>
                    <span class="floating-menu-label">Add Post</span>
                </button>
                <button class="floating-menu-item" id="sendMessageBtn">
                    <i class="fas fa-paper-plane"></i>
                    <span class="floating-menu-label">Send Message</span>
                </button>
                <button class="floating-menu-item" id="aiBotBtn">
                    <i class="fas fa-robot"></i>
                    <span class="floating-menu-label">AI Assistant</span>
                </button>
            </div>

            <!-- Bottom Navigation with Links and Loader -->
            <nav class="bottom-nav">
                <a href="index.html" class="nav-item active">
                    <div class="nav-loader"></div>
                    <i class="fas fa-home"></i>
                    <span class="nav-label">Home</span>
                </a>
                <a href="quranHadith/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-quran"></i>
                    <span class="nav-label">Quran &<br>Hadith</span>
                </a>
                <a href="tools/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-pray"></i>
                    <span class="nav-label">Worship<br>Tools</span>
                </a>
                <a href="learning/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-graduation-cap"></i>
                    <span class="nav-label">Learning</span>
                </a>
                <a href="profile/index.html" class="nav-item">
                    <div class="nav-loader"></div>
                    <i class="fas fa-user"></i>
                    <span class="nav-label">Profile</span>
                </a>
            </nav>
        </div>
    </div>

    <script>
// ============================================
// PRAYER TIMES INTEGRATION
// ============================================

// DOM Elements for prayer times
const locationText = document.getElementById('locationText');
const gregorianDate = document.getElementById('gregorianDate');
const hijriDate = document.getElementById('hijriDate');
const nextPrayerTime = document.getElementById('nextPrayerTime');
const nextPrayerName = document.getElementById('nextPrayerName');
const countdownTimer = document.getElementById('countdownTimer');
const locationBtn = document.getElementById('locationBtn');
const cityChangeModal = document.getElementById('cityChangeModal');
const detectedCityName = document.getElementById('detectedCityName');
const cancelCityChange = document.getElementById('cancelCityChange');
const confirmCityChange = document.getElementById('confirmCityChange');

// Application State for prayer times
const prayerState = {
    location: {
        name: "Loading...",
        latitude: null,
        longitude: null,
        city: "Loading...",
        country: "",
        autoDetected: false
    },
    prayerTimes: {},
    prayers: [
        { name: "Fajr", icon: "", timeKey: "Fajr", index: 0 },
        { name: "Dhuhr", icon: "", timeKey: "Dhuhr", index: 1 },
        { name: "Asr", icon: "", timeKey: "Asr", index: 2 },
        { name: "Maghrib", icon: "", timeKey: "Maghrib", index: 3 },
        { name: "Isha", icon: "", timeKey: "Isha", index: 4 }
    ],
    currentPrayer: null,
    nextPrayer: null,
    countdownInterval: null,
    detectedCity: null,
    showCityModal: false
};

// Hijri Date Calculation Engine
class HijriDateEngine {
    constructor() {
        this.HIJRI_MONTHS = [
            "Muarram", "afar", "Rab al-Awwal", "Rab al-Thn",
            "Jumd al-Awwal", "Jumd al-Thn", "Rajab", "Shabn",
            "Raman", "Shawwl", "Dh al-Qadah", "Dh al-ijjah"
        ];
        
        this.HIJRA_JD = 1948440.5;
        this.HIJRI_MONTH_LENGTHS = [30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29];
        this.LONG_YEARS = [2, 5, 7, 10, 13, 16, 18, 21, 24, 26, 29];
    }

    gregorianToJulian(year, month, day) {
        if (month <= 2) {
            year -= 1;
            month += 12;
        }
        const a = Math.floor(year / 100);
        const b = 2 - a + Math.floor(a / 4);
        return Math.floor(365.25 * (year + 4716)) + 
               Math.floor(30.6001 * (month + 1)) + day + b - 1524.5;
    }

    julianToHijri(jd) {
        const daysSinceEpoch = jd - this.HIJRA_JD;
        let hijriYear = Math.floor(daysSinceEpoch / 354.36607) + 1;
        let yearStart = this.hijriYearStartJD(hijriYear);
        
        if (jd < yearStart) {
            hijriYear--;
            yearStart = this.hijriYearStartJD(hijriYear);
        }
        
        const daysIntoYear = Math.floor(jd - yearStart);
        let monthDays = 0;
        let hijriMonth = 0;
        let hijriDay = 0;
        
        const monthLengths = this.getHijriMonthLengths(hijriYear);
        
        for (let i = 0; i < 12; i++) {
            monthDays += monthLengths[i];
            if (daysIntoYear < monthDays) {
                hijriMonth = i;
                hijriDay = daysIntoYear - (monthDays - monthLengths[i]) + 1;
                break;
            }
        }
        
        return {
            year: hijriYear,
            month: hijriMonth,
            day: hijriDay,
            monthName: this.HIJRI_MONTHS[hijriMonth],
            formatted: `${hijriDay} ${this.HIJRI_MONTHS[hijriMonth]} ${hijriYear} AH`
        };
    }

    hijriYearStartJD(hijriYear) {
        return this.HIJRA_JD + Math.floor((hijriYear - 1) * 354.36607);
    }

    getHijriMonthLengths(hijriYear) {
        const lengths = [...this.HIJRI_MONTH_LENGTHS];
        const yearInCycle = hijriYear % 30;
        if (this.LONG_YEARS.includes(yearInCycle)) {
            lengths[11] = 30;
        }
        return lengths;
    }

    getCurrentHijriDate() {
        const now = new Date();
        const jd = this.gregorianToJulian(now.getFullYear(), now.getMonth() + 1, now.getDate());
        return this.julianToHijri(jd);
    }
}

// Initialize Hijri Date Engine
const hijriEngine = new HijriDateEngine();

// Initialize dates immediately
function initializeDatesImmediately() {
    const now = new Date();
    
    // Format Gregorian date
    const gregorianOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    gregorianDate.textContent = now.toLocaleDateString('en-US', gregorianOptions);
    
    // Calculate Hijri date
    const hijri = hijriEngine.getCurrentHijriDate();
    hijriDate.textContent = hijri.formatted;
}

// Load saved location from localStorage
function loadSavedLocation() {
    const savedLocation = localStorage.getItem('prayerLocation');
    if (savedLocation) {
        try {
            prayerState.location = JSON.parse(savedLocation);
            locationText.textContent = prayerState.location.name;
            return true;
        } catch (e) {
            console.error("Error parsing saved location:", e);
        }
    }
    return false;
}

// Save location to localStorage
function saveLocationToLocalStorage() {
    localStorage.setItem('prayerLocation', JSON.stringify(prayerState.location));
}

// Show city change modal
function showCityChangeModal(cityName) {
    prayerState.detectedCity = cityName;
    detectedCityName.textContent = cityName;
    cityChangeModal.classList.add('active');
}

// Close city change modal
function closeCityChangeModal() {
    cityChangeModal.classList.remove('active');
    prayerState.detectedCity = null;
}

// Get user's location
function getUserLocation() {
    console.log("Getting user location...");
    
    // Try to load saved location first
    const hasSavedLocation = loadSavedLocation();
    
    // Show dates immediately
    initializeDatesImmediately();
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                console.log("Location success:", position.coords);
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                
                // Get city name using reverse geocoding
                getCityFromCoordinates(lat, lng).then(cityName => {
                    // Check if this is a new city
                    if (hasSavedLocation && prayerState.location.name !== cityName) {
                        // Show city change modal
                        showCityChangeModal(cityName);
                    } else {
                        // Update location
                        prayerState.location = {
                            name: cityName,
                            latitude: lat,
                            longitude: lng,
                            autoDetected: true
                        };
                        
                        locationText.textContent = cityName;
                        
                        // Save data
                        saveLocationToLocalStorage();
                        
                        // Fetch prayer times
                        fetchPrayerTimes(lat, lng);
                    }
                }).catch(error => {
                    console.log("Could not get city name:", error);
                    // Use coordinates if city name fails
                    const coordsName = `Location (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
                    
                    if (!hasSavedLocation || prayerState.location.name !== coordsName) {
                        prayerState.location = {
                            name: coordsName,
                            latitude: lat,
                            longitude: lng,
                            autoDetected: true
                        };
                        
                        locationText.textContent = coordsName;
                        fetchPrayerTimes(lat, lng);
                    }
                });
            },
            (error) => {
                console.log("Geolocation error:", error);
                
                // If we have saved location, use it
                if (hasSavedLocation) {
                    fetchPrayerTimes(prayerState.location.latitude, prayerState.location.longitude);
                } else {
                    // Try IP-based location as fallback
                    getLocationFromIP().then(ipLocation => {
                        if (ipLocation) {
                            prayerState.location = ipLocation;
                            locationText.textContent = ipLocation.name;
                            fetchPrayerTimes(ipLocation.latitude, ipLocation.longitude);
                        } else {
                            // Everything failed, use default
                            useDefaultLocation();
                        }
                    });
                }
            },
            {
                enableHighAccuracy: false,
                timeout: 8000,
                maximumAge: 300000
            }
        );
    } else {
        // Geolocation not supported
        if (hasSavedLocation) {
            fetchPrayerTimes(prayerState.location.latitude, prayerState.location.longitude);
        } else {
            getLocationFromIP().then(ipLocation => {
                if (ipLocation) {
                    prayerState.location = ipLocation;
                    locationText.textContent = ipLocation.name;
                    fetchPrayerTimes(ipLocation.latitude, ipLocation.longitude);
                } else {
                    useDefaultLocation();
                }
            });
        }
    }
}

// Get city name from coordinates
async function getCityFromCoordinates(lat, lng) {
    try {
        const proxyUrl = 'https://corsproxy.io/?';
        const targetUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10`;
        
        const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            
            if (data.address) {
                const city = data.address.city || data.address.town || data.address.village;
                const stateRegion = data.address.state;
                const country = data.address.country;
                
                if (city && country) {
                    return `${city}, ${country}`;
                } else if (stateRegion && country) {
                    return `${stateRegion}, ${country}`;
                } else if (country) {
                    return `${country}`;
                }
            }
        }
        
        // Check if coordinates are in Nigeria
        if (lat >= 4 && lat <= 14 && lng >= 3 && lng <= 15) {
            if (lat > 10) return "Northern Nigeria";
            if (lat > 7) return "Central Nigeria";
            return "Southern Nigeria";
        }
        
        return `Location (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
        
    } catch (error) {
        console.error("Reverse geocoding error:", error);
        
        // Check if coordinates are in Nigeria
        if (lat >= 4 && lat <= 14 && lng >= 3 && lng <= 15) {
            if (lat > 10) return "Northern Nigeria";
            if (lat > 7) return "Central Nigeria";
            return "Southern Nigeria";
        }
        
        return `Location (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
    }
}

// Get location from IP as fallback
async function getLocationFromIP() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        if (response.ok) {
            const data = await response.json();
            
            if (data.city && data.country_name) {
                return {
                    name: `${data.city}, ${data.country_name}`,
                    latitude: data.latitude,
                    longitude: data.longitude,
                    autoDetected: false
                };
            }
        }
    } catch (error) {
        console.log("IP location failed:", error);
    }
    return null;
}

// Use default location
function useDefaultLocation() {
    prayerState.location = {
        name: "Lagos, Nigeria",
        latitude: 6.5244,
        longitude: 3.3792,
        autoDetected: false
    };
    
    locationText.textContent = prayerState.location.name;
    fetchPrayerTimes(prayerState.location.latitude, prayerState.location.longitude);
}

// Fetch prayer times
async function fetchPrayerTimes(lat, lng) {
    try {
        console.log("Fetching prayer times for:", lat, lng);
        
        // Update UI to show loading
        nextPrayerName.textContent = "Loading...";
        countdownTimer.textContent = "--:--:--";
        nextPrayerTime.textContent = "Next Prayer: Loading...";
        
        const now = new Date();
        const dateStr = now.toISOString().split('T')[0];
        const calculationMethod = 3; // Karachi University
        const school = 0; // Hanafi
        
        // Get timezone
        const timezone = await getTimezone(lat, lng);
        
        const apiUrl = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lng}&method=${calculationMethod}&school=${school}&timezone=${timezone}`;
        
        console.log("API URL:", apiUrl);
        
        const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`API error: ${response.status}`);
        }
        
        const data = await response.json();
        console.log("API response:", data);
        
        if (data.code !== 200) {
            throw new Error(`API error: ${data.status}`);
        }
        
        const timings = data.data.timings;
        
        prayerState.prayerTimes = {
            Fajr: timings.Fajr || "05:00",
            Dhuhr: timings.Dhuhr || "12:00",
            Asr: timings.Asr || "15:30",
            Maghrib: timings.Maghrib || "18:00",
            Isha: timings.Isha || "19:00"
        };
        
        console.log("Parsed prayer times:", prayerState.prayerTimes);
        
        // Start countdown updates
        startPrayerCountdown();
        
    } catch (error) {
        console.error("Error fetching prayer times:", error);
        
        // Use calculated times as fallback
        const fallbackTimes = calculatePrayerTimesManually(lat, lng);
        prayerState.prayerTimes = fallbackTimes;
        
        // Start countdown updates
        startPrayerCountdown();
    }
}

// Get timezone from coordinates
async function getTimezone(lat, lng) {
    try {
        // Simple timezone estimation based on longitude
        const timezoneOffset = Math.round(lng / 15);
        return `UTC${timezoneOffset >= 0 ? '+' : ''}${timezoneOffset}`;
    } catch (error) {
        console.log("Timezone estimation failed");
    }
    
    return Intl.DateTimeFormat().resolvedOptions().timeZone;
}

// Manual prayer time calculation (fallback)
function calculatePrayerTimesManually(lat, lng) {
    const now = new Date();
    const month = now.getMonth() + 1;
    
    let seasonalAdjustment = 0;
    if (month >= 3 && month <= 5) seasonalAdjustment = 30;
    if (month >= 6 && month <= 8) seasonalAdjustment = 60;
    if (month >= 9 && month <= 11) seasonalAdjustment = 30;
    
    const latitudeAdjustment = Math.round((lat - 6.5) * 4);
    
    const times = {
        Fajr: "05:30",
        Dhuhr: "12:30",
        Asr: "16:00",
        Maghrib: "18:30",
        Isha: "19:45"
    };
    
    const adjustedTimes = {};
    for (const [prayer, time] of Object.entries(times)) {
        const [hours, minutes] = time.split(':').map(Number);
        let totalMinutes = hours * 60 + minutes + latitudeAdjustment;
        
        if (prayer === 'Fajr' || prayer === 'Isha') {
            totalMinutes += seasonalAdjustment;
        }
        
        if (totalMinutes >= 1440) totalMinutes -= 1440;
        if (totalMinutes < 0) totalMinutes += 1440;
        
        const adjHours = Math.floor(totalMinutes / 60);
        const adjMinutes = totalMinutes % 60;
        
        adjustedTimes[prayer] = `${adjHours.toString().padStart(2, '0')}:${adjMinutes.toString().padStart(2, '0')}`;
    }
    
    return adjustedTimes;
}

// Convert time string to minutes since midnight
function timeToMinutes(timeStr) {
    if (!timeStr || timeStr === '--:--') return 0;
    const [hours, minutes] = timeStr.split(':').map(Number);
    return hours * 60 + minutes;
}

// Determine current and next prayer
function findCurrentAndNextPrayer() {
    const now = new Date();
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    
    const prayerTimes = prayerState.prayers.map(prayer => {
        const time = prayerState.prayerTimes[prayer.timeKey];
        const minutes = timeToMinutes(time);
        return {
            ...prayer,
            time,
            minutes
        };
    }).filter(p => p.minutes > 0);
    
    if (prayerTimes.length === 0) {
        return { current: null, next: null };
    }
    
    prayerTimes.sort((a, b) => a.minutes - b.minutes);
    
    let current = null;
    let next = null;
    
    for (let i = 0; i < prayerTimes.length; i++) {
        const currentPrayer = prayerTimes[i];
        const nextPrayer = prayerTimes[(i + 1) % prayerTimes.length];
        
        if (currentMinutes >= currentPrayer.minutes && 
            currentMinutes < nextPrayer.minutes) {
            current = currentPrayer.name;
            next = nextPrayer.name;
            break;
        }
    }
    
    if (!current && currentMinutes < prayerTimes[0].minutes) {
        current = null;
        next = prayerTimes[0].name;
    }
    
    if (!current && currentMinutes >= prayerTimes[prayerTimes.length - 1].minutes) {
        current = prayerTimes[prayerTimes.length - 1].name;
        next = prayerTimes[0].name;
    }
    
    prayerState.currentPrayer = current;
    prayerState.nextPrayer = next;
    
    return { current, next };
}

// Calculate countdown to next prayer with seconds
function calculateCountdownWithSeconds(nextPrayerName) {
    if (!nextPrayerName) return null;
    
    const nextPrayer = prayerState.prayers.find(p => p.name === nextPrayerName);
    if (!nextPrayer) return null;
    
    const nextTimeStr = prayerState.prayerTimes[nextPrayer.timeKey];
    if (!nextTimeStr || nextTimeStr === '--:--') return null;
    
    const now = new Date();
    const [nextHours, nextMinutes] = nextTimeStr.split(':').map(Number);
    
    let nextTime = new Date();
    nextTime.setHours(nextHours, nextMinutes, 0, 0);
    
    if (nextTime < now) {
        nextTime.setDate(nextTime.getDate() + 1);
    }
    
    const diffMs = nextTime - now;
    
    if (diffMs <= 0) return "Now";
    
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
    const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
    const diffSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);
    
    if (diffHours > 0) {
        return `${diffHours}h ${diffMinutes}m ${diffSeconds}s`;
    } else if (diffMinutes > 0) {
        return `${diffMinutes}m ${diffSeconds}s`;
    } else {
        return `${diffSeconds}s`;
    }
}

// Update countdown timer
function updateCountdownTimer() {
    const { current, next } = findCurrentAndNextPrayer();
    
    if (next) {
        const nextPrayerObj = prayerState.prayers.find(p => p.name === next);
        if (nextPrayerObj) {
            nextPrayerName.textContent = next;
            const countdown = calculateCountdownWithSeconds(next);
            countdownTimer.textContent = countdown || "--:--:--";
            nextPrayerTime.textContent = `Next Prayer: ${next} at ${formatTime(prayerState.prayerTimes[nextPrayerObj.timeKey])}`;
        }
    } else {
        nextPrayerName.textContent = "Loading...";
        countdownTimer.textContent = "--:--:--";
        nextPrayerTime.textContent = "Next Prayer: Loading...";
    }
}

// Format time to 12-hour with AM/PM
function formatTime(timeString) {
    if (!timeString || timeString === '--:--') return '--:--';
    
    const [hours, minutes] = timeString.split(':');
    const hour = parseInt(hours);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const formattedHour = hour % 12 || 12;
    return `${formattedHour}:${minutes} ${ampm}`;
}

// Start prayer countdown updates
function startPrayerCountdown() {
    // Clear existing interval
    if (prayerState.countdownInterval) {
        clearInterval(prayerState.countdownInterval);
    }
    
    // Update immediately
    updateCountdownTimer();
    
    // Update every second
    prayerState.countdownInterval = setInterval(() => {
        updateCountdownTimer();
    }, 1000);
}

// ============================================
// PAGE TRANSITION LOADER IMPLEMENTATION - FIXED
// ============================================

// DOM Elements
const pageLoader = document.getElementById('pageLoader');
const pageContent = document.getElementById('pageContent');

// Function to show page loader
function showPageLoader() {
    pageLoader.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Function to hide page loader
function hidePageLoader() {
    pageLoader.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Function to check if two URLs are the same page
function isSamePage(href, currentUrl) {
    // Get current page path without domain
    const currentPath = window.location.pathname;
    const currentHash = window.location.hash;
    
    // Handle different href formats
    if (href === '' || href === '#' || href === './' || href === '/') {
        // Home page links
        return currentPath.endsWith('/') || 
               currentPath.endsWith('index.html') || 
               currentPath === '/';
    }
    
    // Remove query strings and hashes for comparison
    const cleanHref = href.split('?')[0].split('#')[0];
    const cleanCurrentPath = currentPath.split('?')[0].split('#')[0];
    
    // Normalize paths
    const normalizePath = (path) => {
        // Remove leading/trailing slashes and index.html
        path = path.replace(/^\/|\/$/g, '');
        path = path.replace(/index\.html$/i, '');
        return path;
    };
    
    const normalizedHref = normalizePath(cleanHref);
    const normalizedCurrent = normalizePath(cleanCurrentPath);
    
    // Compare normalized paths
    return normalizedHref === normalizedCurrent;
}

// Intercept all link clicks for smooth page transitions
document.addEventListener('click', function(e) {
    // Find the closest anchor element
    const anchor = e.target.closest('a');
    
    if (!anchor) return;
    
    const href = anchor.getAttribute('href');
    
    // Skip if no href, mailto, tel, javascript, or external links
    if (!href || 
        href.startsWith('javascript:') || 
        href.startsWith('mailto:') || 
        href.startsWith('tel:') ||
        href.startsWith('#') ||
        anchor.getAttribute('target') === '_blank') {
        return;
    }
    
    // Skip if it's an external link (starts with http and not same origin)
    if (href.startsWith('http') && !href.includes(window.location.origin)) {
        return;
    }
    
    // Check if we're clicking on the current page
    if (isSamePage(href, window.location.href)) {
        // Don't show loader for same page
        // Just update active state if it's a nav item
        if (anchor.classList.contains('nav-item')) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            anchor.classList.add('active');
        }
        return;
    }
    
    // Prevent default navigation
    e.preventDefault();
    
    // Show page loader
    showPageLoader();
    
    // Fade out current content
    if (pageContent) {
        pageContent.style.opacity = '0';
        pageContent.style.transition = 'opacity 0.3s ease';
    }
    
    // Navigate after 1 SECOND delay to allow loader to show properly
    setTimeout(() => {
        window.location.href = href;
    }, 1000); // Changed from 300ms to 1000ms (1 second)
});

// Hide loader when page is fully loaded
window.addEventListener('load', function() {
    // Wait 100ms before hiding loader (smooth transition)
    setTimeout(hidePageLoader, 100);
    
    // Ensure content is visible
    if (pageContent) {
        pageContent.style.opacity = '1';
    }
    
    // Set active nav item based on current page
    const currentPath = window.location.pathname;
    const currentPage = currentPath.split('/').pop(); // Get the filename
    
    // Reset all nav items
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Set home as active if we're on index.html or root
    if (currentPage === '' || currentPage === 'index.html' || currentPage.includes('index')) {
        document.querySelector('.nav-item[href="index.html"]').classList.add('active');
    }
    
    // Initialize prayer times
    getUserLocation();
});

// Also hide loader if page finishes loading after our transition
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        hidePageLoader();
        if (pageContent) {
            pageContent.style.opacity = '1';
        }
    }
});

// Handle browser back/forward buttons
window.addEventListener('popstate', function() {
    showPageLoader();
});

// Initial hide of loader (in case page loads fast)
setTimeout(() => {
    if (document.readyState === 'complete') {
        hidePageLoader();
    }
}, 100);

        // ============================================
        // EXISTING APPLICATION CODE WITH MODIFICATIONS
        // ============================================

        // Application state
        const state = {
            currentTab: 'for-you',
            followedUsers: new Set(['Dr. Omar Suleiman', 'Mufti Ismail Menk']),
            isDarkMode: false,
            isTransitioning: false,
            downloadedVideos: new Set(),
            fabMenuOpen: false,
            unreadMessages: 3, // Track unread messages
            videos: [
                {
                    id: 1,
                    title: 'The Power of Dua: How to Make Your Prayers Accepted by Allah',
                    views: '12.5K',
                    duration: '8:42',
                    thumbnail: 'https://images.unsplash.com/photo-1512790182412-b19e6d62bc39?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 2,
                    title: 'Understanding the Last 10 Nights of Ramadan - Laylatul Qadr',
                    views: '8.7K',
                    duration: '15:23',
                    thumbnail: 'https://images.unsplash.com/photo-1543163521-1bf539c55dd2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 3,
                    title: '5 Daily Habits That Will Bring You Closer to Allah in Your Daily Life',
                    views: '21.3K',
                    duration: '12:15',
                    thumbnail: 'https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 4,
                    title: 'The Beautiful Story of Prophet Yusuf (AS) - Patience and Trust in Allah\'s Plan',
                    views: '34.8K',
                    duration: '22:47',
                    thumbnail: 'https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 5,
                    title: 'How to Perform Salah Correctly - Step by Step Guide for Beginners',
                    views: '45.2K',
                    duration: '18:32',
                    thumbnail: 'https://images.unsplash.com/photo-1544364631-99bbd8e23f08?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 6,
                    title: 'The Importance of Sadaqah (Charity) in Islam - Rewards and Benefits',
                    views: '28.3K',
                    duration: '14:20',
                    thumbnail: 'https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                },
                {
                    id: 7,
                    title: 'Understanding Zakat - The Third Pillar of Islam Explained Simply',
                    views: '16.9K',
                    duration: '9:45',
                    thumbnail: 'https://images.unsplash.com/photo-1512790182412-b19e6d62bc39?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                }
            ],
            feedData: {
                'for-you': [
                    {
                        id: 1,
                        name: 'Dr. Omar Suleiman',
                        username: 'Fawaid  2 hours ago',
                        profilePic: 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: 'The Prophet Muhammad (peace be upon him) said: "The best among you are those who have the best manners and character." (Sahih Bukhari)<br><br><strong>Benefit:</strong> Good character is a fundamental part of faith. It\'s not just about rituals but how we treat others daily.',
                        likes: 245,
                        comments: 47,
                        timestamp: '2 hours ago',
                        isFollowing: true
                    },
                    {
                        id: 2,
                        name: 'Islamic Community',
                        username: 'Community Post  3 hours ago',
                        profilePic: 'https://images.unsplash.com/photo-1551986788-d0b3e8d2a50c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: '<strong>Beautiful Mosques Around the World</strong><br><br><img src="https://images.unsplash.com/photo-1587560699334-cc4ff634909a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Mosque" class="feed-image"><br><em>The Sheikh Zayed Grand Mosque in Abu Dhabi, UAE. A stunning example of Islamic architecture that welcomes visitors from all faiths.</em><br><br>Mosques are not just places of worship but centers of community, learning, and spiritual growth. Which mosque have you always wanted to visit?',
                        likes: 567,
                        comments: 89,
                        timestamp: '3 hours ago',
                        isFollowing: false,
                        hasImage: true
                    },
                    {
                        id: 3,
                        name: 'Pixel AI',
                        username: 'AI Assistant  Today',
                        profilePic: 'https://images.unsplash.com/photo-1589241062272-c0a000072dfa?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: '<strong>Question:</strong> What is the importance of sincerity (Ikhlas) in worship?<br><br><strong>Answer:</strong> Sincerity (Ikhlas) is the foundation of all acts of worship in Islam. The Prophet () said: "Actions are judged by intentions, and every person will have what they intended." (Bukhari & Muslim)<br><br>Without sincerity, even the greatest acts can become worthless in the sight of Allah. Always check your intentions before any act of worship.',
                        likes: 1200,
                        comments: 89,
                        timestamp: '5 hours ago',
                        isFollowing: false
                    },
                    {
                        id: 4,
                        name: 'Maryam Ahmad',
                        username: 'Question  1 day ago',
                        profilePic: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: '<strong>Question:</strong> What\'s the ruling on listening to music during Ramadan? Is it permissible if it\'s only nasheeds without instruments?<br><br><strong>Answered by Pixel AI:</strong> Most scholars agree that musical instruments are prohibited in Islam. However, vocal nasheeds without musical accompaniment are permissible. During Ramadan, it\'s especially recommended to avoid anything that distracts from the remembrance of Allah and Quran recitation.',
                        likes: 87,
                        comments: 31,
                        timestamp: '1 day ago',
                        isFollowing: false
                    }
                ],
                'following': [
                    {
                        id: 1,
                        name: 'Dr. Omar Suleiman',
                        username: 'Fawaid  2 hours ago',
                        profilePic: 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: 'The Prophet Muhammad (peace be upon him) said: "The best among you are those who have the best manners and character." (Sahih Bukhari)<br><br><strong>Benefit:</strong> Good character is a fundamental part of faith. It\'s not just about rituals but how we treat others daily.',
                        likes: 245,
                        comments: 47,
                        timestamp: '2 hours ago',
                        isFollowing: true
                    },
                    {
                        id: 5,
                        name: 'Mufti Ismail Menk',
                        username: 'Scholar  3 days ago',
                        profilePic: 'https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: 'Patience (Sabr) is not merely about waiting. It\'s about maintaining good behavior and composure while waiting. The Prophet (pbuh) said, "No one has been given anything better and more comprehensive than patience." (Bukhari & Muslim)<br><br>True patience is when you accept Allah\'s decree without complaint.',
                        likes: 512,
                        comments: 67,
                        timestamp: '3 days ago',
                        isFollowing: true
                    }
                ],
                'scholars': [
                    {
                        id: 5,
                        name: 'Mufti Ismail Menk',
                        username: 'Scholar  3 days ago',
                        profilePic: 'https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: 'Patience (Sabr) is not merely about waiting. It\'s about maintaining good behavior and composure while waiting. The Prophet (pbuh) said, "No one has been given anything better and more comprehensive than patience." (Bukhari & Muslim)<br><br>True patience is when you accept Allah\'s decree without complaint.',
                        likes: 512,
                        comments: 67,
                        timestamp: '3 days ago',
                        isFollowing: true
                    },
                    {
                        id: 6,
                        name: 'Islamic Architecture Society',
                        username: 'Educational  1 week ago',
                        profilePic: 'https://images.unsplash.com/photo-1580301762395-21ce84d00bc6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: '<strong>The Beauty of Islamic Calligraphy</strong><br><br><img src="https://images.unsplash.com/photo-1551986788-d0b3e8d2a50c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Islamic Calligraphy" class="feed-image"><br><em>"Bismillah ir-Rahman ir-Rahim" - In the name of Allah, the Most Gracious, the Most Merciful.</em><br><br>Islamic calligraphy is a visual art form that beautifully combines spirituality with artistic expression. The Arabic script itself is considered a gift from Allah, making calligraphy a sacred art form in Islamic culture.',
                        likes: 342,
                        comments: 56,
                        timestamp: '1 week ago',
                        isFollowing: false,
                        hasImage: true
                    },
                    {
                        id: 7,
                        name: 'Shaykh Yasir Qadhi',
                        username: 'Lecture  5 days ago',
                        profilePic: 'https://images.unsplash.com/photo-1507591064344-4c6ce005-128?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        content: 'Understanding the Quran requires both knowledge of Arabic and understanding of the context. The companions of the Prophet (pbuh) learned the Quran directly from him with proper context and implementation.<br><br>We must approach the Quran with humility, seeking to understand before we attempt to explain.',
                        likes: 789,
                        comments: 124,
                        timestamp: '5 days ago',
                        isFollowing: false
                    }
                ]
            },
            comments: {
                1: [
                    {
                        id: 1,
                        name: 'Aisha Rahman',
                        profilePic: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        text: 'This hadith always reminds me to check my intentions throughout the day.',
                        time: '1 hour ago',
                        likes: 3
                    },
                    {
                        id: 2,
                        name: 'Ahmed Yusuf',
                        profilePic: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        text: 'JazakAllah khair for this reminder. Character truly matters in Islam.',
                        time: '45 minutes ago',
                        likes: 1
                    }
                ],
                2: [
                    {
                        id: 3,
                        name: 'Sara Khan',
                        profilePic: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        text: 'MasyaAllah, the Sheikh Zayed Mosque is breathtaking! I visited last year during Ramadan.',
                        time: '2 hours ago',
                        likes: 12
                    },
                    {
                        id: 4,
                        name: 'Omar Ali',
                        profilePic: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                        text: 'The Blue Mosque in Istanbul is also incredible. Islamic architecture is truly divine!',
                        time: '1 hour ago',
                        likes: 8
                    }
                ]
            }
        };

        // DOM Elements
        const downloadVideoBtn = document.getElementById('downloadVideoBtn');
        const fabButton = document.getElementById('fabButton');
        const fabMenu = document.getElementById('fabMenu');
        const addPostBtn = document.getElementById('addPostBtn');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const aiBotBtn = document.getElementById('aiBotBtn');
        const messagesBtn = document.getElementById('messagesBtn');
        const messageBadge = document.getElementById('messageBadge');
        const quickAddPostBtn = document.getElementById('quickAddPostBtn');
        const quickTasbihBtn = document.getElementById('quickTasbihBtn');
        const addPostModal = document.getElementById('addPostModal');
        const addPostClose = document.getElementById('addPostClose');
        const addPostText = document.getElementById('addPostText');
        const addImageBtn = document.getElementById('addImageBtn');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const addPostSubmit = document.getElementById('addPostSubmit');
        const tasbeehModal = document.getElementById('tasbeehModal');
        const tasbeehClose = document.getElementById('tasbeehClose');
        const tasbeehCounter = document.getElementById('tasbeehCounter');
        const tasbeehButton = document.getElementById('tasbeehButton');
        const tasbeehReset = document.getElementById('tasbeehReset');
        const tasbeehPresetBtns = document.querySelectorAll('.tasbeeh-preset-btn');

        // Digital Tasbeeh functionality
        let tasbeehCount = 0;
        let tasbeehTarget = 33; // Default target for SubhanAllah

        // Update tasbeeh counter display
        function updateTasbeehCounter() {
            tasbeehCounter.textContent = tasbeehCount;
        }

        // Increment tasbeeh count
        tasbeehButton.addEventListener('click', function() {
            tasbeehCount++;
            updateTasbeehCounter();
            
            // Add visual feedback
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 100);
        });

        // Reset tasbeeh counter
        tasbeehReset.addEventListener('click', function() {
            tasbeehCount = 0;
            updateTasbeehCounter();
        });

        // Set tasbeeh preset
        tasbeehPresetBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                tasbeehPresetBtns.forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                // Set the target count
                tasbeehTarget = parseInt(this.getAttribute('data-count'));
            });
        });

        // Open tasbeeh modal
        quickTasbihBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            tasbeehModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        // Close tasbeeh modal
        tasbeehClose.addEventListener('click', function() {
            tasbeehModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        // Close tasbeeh modal when clicking outside
        tasbeehModal.addEventListener('click', function(event) {
            if (event.target === tasbeehModal) {
                tasbeehModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Add Post Modal functionality
        let selectedImage = null;

        // Open add post modal from quick button
        quickAddPostBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openAddPostModal();
        });

        // Open add post modal from FAB menu
        addPostBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openAddPostModal();
            
            // Close FAB menu
            state.fabMenuOpen = false;
            fabButton.classList.remove('active');
            fabMenu.classList.remove('active');
        });

        function openAddPostModal() {
            addPostModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            addPostText.focus();
        }

        // Close add post modal
        addPostClose.addEventListener('click', function() {
            addPostModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetAddPostForm();
        });

        // Close add post modal when clicking outside
        addPostModal.addEventListener('click', function(event) {
            if (event.target === addPostModal) {
                addPostModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                resetAddPostForm();
            }
        });

        // Reset add post form
        function resetAddPostForm() {
            addPostText.value = '';
            selectedImage = null;
            imagePreviewContainer.classList.remove('active');
            imagePreview.src = '';
            addPostSubmit.disabled = true;
        }

        // Enable/disable post button based on text input
        addPostText.addEventListener('input', function() {
            addPostSubmit.disabled = this.value.trim() === '';
        });

        // Add image button
        addImageBtn.addEventListener('click', function() {
            imageUpload.click();
        });

        // Handle image upload
        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Check file size (max 1MB)
                if (file.size > 1024 * 1024) {
                    alert('Image size must be less than 1MB. Please choose a smaller image.');
                    return;
                }
                
                // Compress image
                compressImage(file, 800, 0.8).then(compressedFile => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        selectedImage = compressedFile;
                        imagePreview.src = e.target.result;
                        imagePreviewContainer.classList.add('active');
                    };
                    reader.readAsDataURL(compressedFile);
                }).catch(error => {
                    console.error('Image compression error:', error);
                    alert('Failed to process image. Please try another image.');
                });
            }
        });

        // Compress image function
        function compressImage(file, maxWidth, quality) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(event) {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // Calculate new dimensions
                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob(function(blob) {
                            resolve(new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            }));
                        }, 'image/jpeg', quality);
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }

        // Remove image
        removeImageBtn.addEventListener('click', function() {
            selectedImage = null;
            imagePreviewContainer.classList.remove('active');
            imagePreview.src = '';
            imageUpload.value = '';
        });

        // Submit post
        addPostSubmit.addEventListener('click', function() {
            const postText = addPostText.value.trim();
            if (!postText) return;
            
            // Create new post
            const newPost = {
                id: Date.now(),
                name: 'You',
                username: 'Just now',
                profilePic: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80',
                content: postText,
                likes: 0,
                comments: 0,
                timestamp: 'Just now',
                isFollowing: false
            };
            
            // Add image if selected
            if (selectedImage) {
                newPost.content += `<br><br><img src="${imagePreview.src}" alt="Posted image" class="feed-image">`;
                newPost.hasImage = true;
            }
            
            // Add to feed data
            state.feedData['for-you'].unshift(newPost);
            
            // Close modal and reset form
            addPostModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetAddPostForm();
            
            // Show success message
            showNotification('Post published successfully!');
            
            // Refresh feed
            renderFeed();
        });

        // City change modal handlers
        cancelCityChange.addEventListener('click', function() {
            closeCityChangeModal();
        });

        confirmCityChange.addEventListener('click', function() {
            if (prayerState.detectedCity) {
                // Update location with detected city
                // In a real app, you would update coordinates here
                locationText.textContent = prayerState.detectedCity;
                prayerState.location.name = prayerState.detectedCity;
                saveLocationToLocalStorage();
                closeCityChangeModal();
                showNotification('Location updated successfully!');
            }
        });

        // Location button click handler
        locationBtn.addEventListener('click', function() {
            getUserLocation();
        });

        // Messages button functionality
        messagesBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Navigate to messages page with loader
            showPageLoader();
            setTimeout(() => {
                window.location.href = 'Scholars/index.html';
            }, 300);
        });

        // Floating Action Button functionality
        fabButton.addEventListener('click', function() {
            state.fabMenuOpen = !state.fabMenuOpen;
            
            if (state.fabMenuOpen) {
                this.classList.add('active');
                fabMenu.classList.add('active');
            } else {
                this.classList.remove('active');
                fabMenu.classList.remove('active');
            }
        });

        // Close FAB menu when clicking outside
        document.addEventListener('click', function(event) {
            if (state.fabMenuOpen && 
                !fabButton.contains(event.target) && 
                !fabMenu.contains(event.target)) {
                state.fabMenuOpen = false;
                fabButton.classList.remove('active');
                fabMenu.classList.remove('active');
            }
        });

        // FAB menu button functionality
        sendMessageBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            showPageLoader();
            setTimeout(() => {
                window.location.href = 'Scholars/index.html';
            }, 300);
        });

        aiBotBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            showPageLoader();
            setTimeout(() => {
                window.location.href = 'deenai.html';
            }, 300);
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const searchButton = document.getElementById('searchButton');
        
        themeToggle.addEventListener('click', function() {
            state.isDarkMode = !state.isDarkMode;
            
            if (state.isDarkMode) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                this.innerHTML = '<i class="fas fa-sun"></i><span>Light</span>';
                
                // Ensure search icon is white in dark mode
                searchButton.style.color = 'white';
                
                // Ensure location, date and prayer text stays white in dark mode
                document.querySelectorAll('.location-btn, .date-info, .islamic-date, .gregorian-date, .next-prayer, .countdown-timer').forEach(el => {
                    el.style.color = 'white';
                });
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                this.innerHTML = '<i class="fas fa-moon"></i><span>Dark</span>';
                
                // Reset search icon to default in light mode
                searchButton.style.color = '';
                
                // Reset to default colors in light mode
                document.querySelectorAll('.location-btn, .date-info, .islamic-date, .gregorian-date, .next-prayer, .countdown-timer').forEach(el => {
                    el.style.color = '';
                });
            }
            
            // Save theme preference to localStorage
            localStorage.setItem('isDarkMode', state.isDarkMode);
        });
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('isDarkMode');
        if (savedTheme === 'true') {
            state.isDarkMode = true;
            body.classList.remove('light-theme');
            body.classList.add('dark-theme');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light</span>';
            
            // Ensure search icon is white in dark mode
            searchButton.style.color = 'white';
            
            // Ensure location, date and prayer text stays white in dark mode
            document.querySelectorAll('.location-btn, .date-info, .islamic-date, .gregorian-date, .next-prayer, .countdown-timer').forEach(el => {
                el.style.color = 'white';
            });
        } else {
            state.isDarkMode = false;
            body.classList.remove('dark-theme');
            body.classList.add('light-theme');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark</span>';
            
            // Reset search icon to default in light mode
            searchButton.style.color = '';
        }
        
        // Video modal functionality
        const videoModal = document.getElementById('videoModal');
        const closeVideoBtn = document.getElementById('closeVideoBtn');
        const videoModalTitle = document.getElementById('videoModalTitle');
        const videoModalStats = document.getElementById('videoModalStats');
        let currentVideoId = null;
        
        // Download video functionality
        downloadVideoBtn.addEventListener('click', function() {
            if (currentVideoId && !this.classList.contains('downloading')) {
                const video = state.videos.find(v => v.id == currentVideoId);
                
                if (video) {
                    // Show downloading animation
                    this.classList.add('downloading');
                    this.innerHTML = '<i class="fas fa-spinner"></i>';
                    
                    // Simulate download process
                    setTimeout(() => {
                        // Add to downloaded videos
                        state.downloadedVideos.add(currentVideoId);
                        
                        // Change to completed state
                        this.classList.remove('downloading');
                        this.classList.add('completed');
                        this.innerHTML = '<i class="fas fa-check"></i>';
                        
                        showNotification('Video downloaded successfully!');
                        
                        // Reset button after 3 seconds
                        setTimeout(() => {
                            this.classList.remove('completed');
                            this.innerHTML = '<i class="fas fa-download"></i>';
                        }, 3000);
                    }, 2000); // Simulate 2 second download
                }
            }
        });
        
        // Function to show notification
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: var(--primary-green);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                font-weight: 500;
                animation: slideIn 0.3s ease, slideOut 0.3s ease 2s forwards;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove notification after animation
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 2500);
            
            // Add keyframe animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Open video modal when video card is clicked
        document.addEventListener('click', function(event) {
            const videoCard = event.target.closest('.video-card');
            if (videoCard) {
                const videoId = videoCard.getAttribute('data-video');
                const video = state.videos.find(v => v.id == videoId);
                
                if (video) {
                    currentVideoId = videoId;
                    videoModalTitle.textContent = video.title;
                    videoModalStats.innerHTML = `
                        <span><i class="far fa-eye"></i> ${video.views} views</span>
                        <span><i class="far fa-clock"></i> ${video.duration}</span>
                    `;
                    
                    // Reset download button state
                    downloadVideoBtn.classList.remove('downloading', 'completed');
                    downloadVideoBtn.innerHTML = '<i class="fas fa-download"></i>';
                    
                    videoModal.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Prevent scrolling when modal is open
                }
            }
        });
        
        // Close video modal
        closeVideoBtn.addEventListener('click', function() {
            videoModal.classList.remove('active');
            document.body.style.overflow = 'auto'; // Restore scrolling
            currentVideoId = null;
        });
        
        // Close modal when clicking outside
        videoModal.addEventListener('click', function(event) {
            if (event.target === videoModal) {
                videoModal.classList.remove('active');
                document.body.style.overflow = 'auto'; // Restore scrolling
                currentVideoId = null;
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && videoModal.classList.contains('active')) {
                videoModal.classList.remove('active');
                document.body.style.overflow = 'auto'; // Restore scrolling
                currentVideoId = null;
            }
        });
        
        // Background carousel functionality
        const carousel = document.getElementById('backgroundCarousel');
        const indicators = document.querySelectorAll('.indicator');
        let currentSlide = 0;
        const totalSlides = 3;
        
        function updateCarousel() {
            carousel.style.transform = `translateX(-${currentSlide * 33.333}%)`;
            
            indicators.forEach((indicator, index) => {
                if (index === currentSlide) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }
        
        indicators.forEach(indicator => {
            indicator.addEventListener('click', function() {
                currentSlide = parseInt(this.getAttribute('data-slide'));
                updateCarousel();
            });
        });
        
        // Auto-rotate carousel every 10 seconds
        setInterval(() => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }, 10000);
        
        // Tab switching functionality
        const tabs = document.querySelectorAll('.feed-tab');
        const dailyVideosSection = document.getElementById('dailyVideosSection');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide daily videos section based on tab
                if (tabId === 'for-you') {
                    dailyVideosSection.classList.add('active');
                } else {
                    dailyVideosSection.classList.remove('active');
                }
                
                // Load content for the selected tab
                state.currentTab = tabId;
                renderFeed();
            });
        });
        
        // Render feed based on current tab
        function renderFeed() {
            const feedContainer = document.getElementById('feedContainer');
            const currentData = state.feedData[state.currentTab];
            
            if (currentData.length === 0) {
                feedContainer.innerHTML = `
                    <div class="no-content-message">
                        <i class="fas fa-users-slash"></i>
                        <h3>No content to show</h3>
                        <p>${state.currentTab === 'following' ? 'Follow users to see their content here' : 'No content available'}</p>
                    </div>
                `;
                return;
            }
            
            let feedHTML = '';
            
            // Filter following tab to only show followed users
            let filteredData = currentData;
            if (state.currentTab === 'following') {
                filteredData = currentData.filter(post => state.followedUsers.has(post.name));
            }
            
            filteredData.forEach(post => {
                const isFollowing = state.followedUsers.has(post.name);
                const hasManyComments = post.comments > 5;
                
                feedHTML += `
                    <div class="feed-card" data-post-id="${post.id}">
                        <div class="feed-header">
                            <img src="${post.profilePic}" alt="Profile" class="profile-pic">
                            <div class="user-info">
                                <h3>
                                    ${post.name}
                                    <button class="follow-btn ${isFollowing ? 'following' : ''}" data-user="${post.name}">
                                        ${isFollowing ? 'Following' : 'Follow'}
                                    </button>
                                </h3>
                                <p>${post.username}</p>
                            </div>
                        </div>
                        <div class="feed-content">
                            ${post.content}
                        </div>
                        <div class="feed-actions">
                            <div class="action-buttons">
                                <button class="action-btn like-btn" data-post="${post.id}">
                                    <i class="far fa-heart"></i> <span class="like-count">${post.likes}</span>
                                </button>
                                <button class="action-btn comment-btn" data-post="${post.id}">
                                    <i class="far fa-comment"></i> <span class="comment-count">${post.comments}</span>
                                </button>
                            </div>
                            <div class="timestamp">${post.timestamp}</div>
                        </div>
                        <div class="comment-section" id="commentSection${post.id}">
                            <div class="comments-list ${hasManyComments ? 'large' : ''}" id="commentsList${post.id}">
                                ${renderComments(post.id)}
                            </div>
                            <div class="add-comment">
                                <div class="comment-input-container">
                                    <input type="text" class="comment-input" id="commentInput${post.id}" placeholder="Add a comment...">
                                    <button class="emoji-btn" data-post="${post.id}">
                                        <i class="far fa-smile"></i>
                                    </button>
                                    <div class="emoji-picker" id="emojiPicker${post.id}">
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                        <div class="emoji-option"></div>
                                    </div>
                                </div>
                                <button class="post-comment-btn" data-post="${post.id}" id="postCommentBtn${post.id}" disabled>Post</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            feedContainer.innerHTML = feedHTML;
            
            // Reattach event listeners
            attachEventListeners();
        }
        
        // Render comments for a post
        function renderComments(postId) {
            const postComments = state.comments[postId] || [];
            let commentsHTML = '';
            
            postComments.forEach(comment => {
                commentsHTML += `
                    <div class="comment-item">
                        <img src="${comment.profilePic}" alt="User" class="comment-user-pic">
                        <div class="comment-content">
                            <div class="comment-user-name">${comment.name}</div>
                            <div class="comment-text">${comment.text}</div>
                            <div class="comment-meta">
                                <span class="comment-time">${comment.time}</span>
                                <button class="comment-like-btn ${comment.liked ? 'liked' : ''}" data-comment-id="${comment.id}">
                                    <i class="${comment.liked ? 'fas' : 'far'} fa-heart"></i> ${comment.likes}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            return commentsHTML;
        }
        
        // Attach event listeners to dynamic elements
        function attachEventListeners() {
            // Search functionality
            const searchButton = document.getElementById('searchButton');
            const searchInputContainer = document.getElementById('searchInputContainer');
            const searchInput = document.getElementById('searchInput');
            let isSearchVisible = false;
            
            searchButton.addEventListener('click', function() {
                isSearchVisible = !isSearchVisible;
                
                if (isSearchVisible) {
                    searchInputContainer.style.display = 'block';
                    setTimeout(() => {
                        searchInput.focus();
                    }, 100);
                } else {
                    searchInputContainer.style.display = 'none';
                    searchInput.value = '';
                }
            });
            
            // Close search when clicking outside
            document.addEventListener('click', function(event) {
                if (isSearchVisible && 
                    !searchInputContainer.contains(event.target) && 
                    !searchButton.contains(event.target)) {
                    searchInputContainer.style.display = 'none';
                    isSearchVisible = false;
                    searchInput.value = '';
                }
            });
            
            // Quick button hover effects
            document.querySelectorAll('.quick-button').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.05)';
                    this.style.boxShadow = '0 12px 24px rgba(0, 0, 0, 0.15)';
                    this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                    this.style.boxShadow = '0 6px 12px rgba(0, 0, 0, 0.08)';
                    this.style.borderColor = 'transparent';
                });
            });
            
            // Like button functionality
            document.querySelectorAll('.like-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = this.getAttribute('data-post');
                    const likeCountElement = this.querySelector('.like-count');
                    let likeCount = parseInt(likeCountElement.textContent);
                    
                    if (this.classList.contains('liked')) {
                        // Unlike
                        this.classList.remove('liked');
                        this.innerHTML = `<i class="far fa-heart"></i> <span class="like-count">${likeCount - 1}</span>`;
                        
                        // Update state
                        const post = state.feedData[state.currentTab].find(p => p.id == postId);
                        if (post) post.likes--;
                    } else {
                        // Like
                        this.classList.add('liked');
                        this.innerHTML = `<i class="fas fa-heart"></i> <span class="like-count">${likeCount + 1}</span>`;
                        
                        // Update state
                        const post = state.feedData[state.currentTab].find(p => p.id == postId);
                        if (post) post.likes++;
                    }
                });
            });
            
            // Comment button functionality
            document.querySelectorAll('.comment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = this.getAttribute('data-post');
                    const commentSection = document.getElementById(`commentSection${postId}`);
                    
                    // Close all other comment sections
                    document.querySelectorAll('.comment-section').forEach(section => {
                        if (section.id !== `commentSection${postId}`) {
                            section.classList.remove('active');
                        }
                    });
                    
                    // Toggle current comment section
                    commentSection.classList.toggle('active');
                    
                    // Scroll to comment section if opened
                    if (commentSection.classList.contains('active')) {
                        setTimeout(() => {
                            commentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                });
            });
            
            // Follow button functionality
            document.querySelectorAll('.follow-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userName = this.getAttribute('data-user');
                    
                    if (state.followedUsers.has(userName)) {
                        // Unfollow
                        state.followedUsers.delete(userName);
                        this.textContent = 'Follow';
                        this.classList.remove('following');
                    } else {
                        // Follow
                        state.followedUsers.add(userName);
                        this.textContent = 'Following';
                        this.classList.add('following');
                    }
                    
                    // If we're on the following tab, refresh the feed
                    if (state.currentTab === 'following') {
                        renderFeed();
                    }
                });
            });
            
            // Video card hover effects
            document.querySelectorAll('.video-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        }
        
        // Initial render
        renderFeed();
        
        // Show videos section for For You tab by default
        dailyVideosSection.classList.add('active');
        
        // Initial carousel setup
        updateCarousel();
        
        // Animate cards on load
        document.addEventListener('DOMContentLoaded', function() {
            // Animate video cards on load
            const videoCards = document.querySelectorAll('.video-card');
            videoCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateX(50px)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateX(0)';
                }, 200 + (index * 100));
            });

            // Animate quick buttons on load
            const quickButtons = document.querySelectorAll('.quick-button');
            quickButtons.forEach((button, index) => {
                button.style.opacity = '0';
                button.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    button.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    button.style.opacity = '1';
                    button.style.transform = 'translateY(0)';
                }, 300 + (index * 50));
            });
        });

        // Initial hide of loader (in case page loads fast)
        setTimeout(() => {
            if (document.readyState === 'complete') {
                hidePageLoader();
            }
        }, 100);
    </script>
</body>
</html>