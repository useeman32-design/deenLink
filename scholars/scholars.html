<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Scholars | DeenLink</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary-green: #1D6F42;
            --light-green: #E8F5E9;
            --accent-gold: #D4AF37;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #E0E0E0;
            --dark-gray: #757575;
            --text-dark: #333333;
            --deenlink-purple: #6A1B9A;
            --ask-blue: #0D47A1;
            --ask-light-blue: #E3F2FD;
            --success-green: #27ae60;
        }

        /* Dark Theme Variables */
        .dark-theme {
            --primary-green: #2ecc71;
            --light-green: #1a2526;
            --accent-gold: #f39c12;
            --white: #2c3e50;
            --light-gray: #34495e;
            --medium-gray: #4a6572;
            --dark-gray: #bdc3c7;
            --text-dark: #ecf0f1;
            --deenlink-purple: #9b59b6;
            --ask-blue: #3498db;
            --ask-light-blue: #1a3a5f;
            --success-green: #2ecc71;
        }

        body {
            background-color: var(--light-gray);
            color: var(--text-dark);
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Page Loader Overlay */
        #pageLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #pageLoader.active {
            display: flex;
            opacity: 1;
        }

        /* Islamic Loader */
        .islamic-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
        }

        .loader-crescent {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .crescent {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-gold));
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            animation: crescentFloat 3s ease-in-out infinite;
        }

        .crescent::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 50%;
        }

        .loader-star {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--accent-gold);
            font-size: 24px;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        .loader-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1px;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes crescentFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        @keyframes starTwinkle {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        @keyframes textPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Page Transition Overlay */
        .page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page-transition-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* Modal Loader Overlay */
        .modal-loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-loader-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* Container */
        .container {
            max-width: 480px;
            margin: 0 auto;
            position: relative;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 100%;
            }
        }

        /* Top Section - Scholars Theme */
        .top-section {
            height: 180px;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .top-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(29, 111, 66, 0.95) 0%, rgba(106, 27, 154, 0.9) 100%);
            z-index: 1;
        }

        .dark-theme .top-section::before {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.95) 0%, rgba(155, 89, 182, 0.9) 100%);
        }

        .top-section-background {
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0;
            left: 0;
        }

        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            z-index: 10;
        }

        @media (min-width: 768px) {
            .top-bar {
                padding: 20px 30px;
            }
        }

        .page-title {
            color: white;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title i {
            font-size: 22px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* DeenPoints Balance Display */
        .deenpoints-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .deenpoints-balance:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .deenpoints-balance img {
            width: 24px;
            height: 24px;
        }

        .page-subtitle {
            position: absolute;
            bottom: 40px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            padding: 0 20px;
            z-index: 2;
        }

        .page-subtitle h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .page-subtitle p {
            font-size: 14px;
            opacity: 0.9;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Search Bar */
        .search-container {
            padding: 16px;
            position: relative;
            z-index: 5;
            margin-top: -20px;
        }

        @media (min-width: 768px) {
            .search-container {
                padding: 20px 30px;
                max-width: 800px;
                margin: -20px auto 0;
            }
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 16px 50px 16px 20px;
            border-radius: 12px;
            border: none;
            background-color: var(--white);
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            outline: none;
            color: var(--text-dark);
            transition: box-shadow 0.3s;
        }

        .search-input:focus {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--dark-gray);
            font-size: 18px;
        }

        /* Scholars Container */
        .scholars-container {
            padding: 10px 16px 40px;
        }

        @media (min-width: 768px) {
            .scholars-container {
                padding: 15px 30px 50px;
                max-width: 800px;
                margin: 0 auto;
            }
        }

        .scholars-count {
            font-size: 14px;
            color: var(--dark-gray);
            margin-bottom: 15px;
            padding-left: 5px;
        }

        .scholars-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .scholar-card {
            background-color: var(--white);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            gap: 16px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .scholar-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .dark-theme .scholar-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .scholar-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
            border: 3px solid var(--light-green);
        }

        .scholar-info {
            flex: 1;
            min-width: 0;
        }

        .scholar-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .scholar-description {
            font-size: 13px;
            color: var(--dark-gray);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .scholar-expertise {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .expertise-tag {
            background-color: var(--light-green);
            color: var(--primary-green);
            font-size: 11px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 20px;
            white-space: nowrap;
        }

        .dark-theme .expertise-tag {
            background-color: rgba(46, 204, 113, 0.2);
        }

        /* Scholar Card Buttons */
        .scholar-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .ask-scholar-btn, .view-profile-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .ask-scholar-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
        }

        .ask-scholar-btn:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        .view-profile-btn {
            background-color: var(--light-gray);
            color: var(--text-dark);
            border: 1px solid var(--medium-gray);
        }

        .view-profile-btn:hover {
            background-color: var(--medium-gray);
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: var(--white);
            z-index: 10;
            border-radius: 20px 20px 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-deenpoints {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--light-green);
            padding: 6px 12px;
            border-radius: 20px;
            color: var(--primary-green);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-deenpoints:hover {
            background: rgba(46, 204, 113, 0.3);
        }

        .modal-deenpoints img {
            width: 20px;
            height: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--dark-gray);
            font-size: 20px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .close-modal:hover {
            background-color: var(--light-gray);
        }

        .modal-body {
            padding: 20px;
        }

        /* Step Indicators */
        .step-indicators {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step-indicators::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background-color: var(--medium-gray);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--medium-gray);
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background-color: var(--primary-green);
            color: white;
        }

        .step.completed .step-number {
            background-color: var(--success-green);
            color: white;
        }

        .step-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .step.active .step-label {
            color: var(--primary-green);
            font-weight: 600;
        }

        .step.completed .step-label {
            color: var(--success-green);
            font-weight: 600;
        }

        /* Step Content */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Loading Overlay for Step 3 */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--white);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20;
            border-radius: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Success Step */
        .success-step {
            text-align: center;
            padding: 30px 20px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background-color: var(--success-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            color: white;
            font-size: 36px;
            animation: successPulse 2s ease infinite;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .success-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--success-green);
            margin-bottom: 15px;
        }

        .success-message {
            font-size: 16px;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .success-details {
            background-color: var(--light-green);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: left;
        }

        .success-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .success-detail:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            color: var(--dark-gray);
        }

        .detail-value {
            font-weight: 500;
            color: var(--text-dark);
        }

        .detail-value.deenpoints {
            color: var(--accent-gold);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .detail-value.deenpoints img {
            width: 16px;
            height: 16px;
        }

        .done-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .done-btn:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 1px solid var(--medium-gray);
            background-color: var(--white);
            font-size: 14px;
            color: var(--text-dark);
            transition: border-color 0.3s;
            outline: none;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Poppins', sans-serif;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(29, 111, 66, 0.1);
        }

        /* Category Selection - Multi-select */
        .category-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .category-option {
            padding: 10px 15px;
            border-radius: 20px;
            border: 2px solid var(--medium-gray);
            background-color: var(--white);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-option:hover {
            border-color: var(--primary-green);
            background-color: var(--light-green);
        }

        .category-option.selected {
            border-color: var(--primary-green);
            background-color: var(--light-green);
            color: var(--primary-green);
        }

        .category-option i {
            font-size: 14px;
        }

        /* Privacy Options */
        .privacy-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .privacy-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--medium-gray);
            background-color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
        }

        .privacy-option:hover {
            border-color: var(--primary-green);
            background-color: var(--light-green);
        }

        .privacy-option.selected {
            border-color: var(--primary-green);
            background-color: var(--light-green);
        }

        .privacy-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--dark-gray);
        }

        .privacy-option.selected .privacy-icon {
            color: var(--primary-green);
        }

        .privacy-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .privacy-desc {
            font-size: 11px;
            color: var(--dark-gray);
        }

        /* Priority Options */
        .priority-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }

        .priority-option {
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--medium-gray);
            background-color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
        }

        .priority-option:hover {
            border-color: var(--accent-gold);
        }

        .priority-option.selected {
            border-color: var(--accent-gold);
            background-color: rgba(212, 175, 55, 0.1);
        }

        .priority-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .priority-name {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .priority-cost {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .priority-cost img {
            width: 16px;
            height: 16px;
        }

        .priority-desc {
            font-size: 13px;
            color: var(--dark-gray);
            line-height: 1.5;
        }

        /* DeenPoints Input */
        .deenpoints-input-container {
            position: relative;
        }

        .deenpoints-input {
            padding-right: 100px !important;
        }

        .deenpoints-label {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: var(--dark-gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .deenpoints-label img {
            width: 18px;
            height: 18px;
        }

        /* Important Note Box */
        .important-note {
            background-color: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-gold);
        }

        .important-note-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 8px;
        }

        .important-note-text {
            font-size: 13px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Modal Navigation */
        .modal-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--medium-gray);
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background-color: var(--medium-gray);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            background-color: var(--dark-gray);
            color: white;
        }

        .btn-primary {
            background-color: var(--primary-green);
            color: white;
        }

        .btn-primary:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background-color: var(--dark-gray);
            cursor: not-allowed;
            transform: none;
        }

        /* Selected Scholar Display */
        .selected-scholar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--light-green);
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-green);
        }

        .selected-scholar-img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
        }

        .selected-scholar-info h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .selected-scholar-info p {
            font-size: 12px;
            color: var(--dark-gray);
        }

        /* Purchase DeenPoints Modal */
        .purchase-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 480px) {
            .purchase-options {
                grid-template-columns: 1fr;
            }
        }

        .purchase-option {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--medium-gray);
            background-color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .purchase-option:hover {
            border-color: var(--accent-gold);
            transform: translateY(-3px);
        }

        .purchase-option.selected {
            border-color: var(--accent-gold);
            background-color: rgba(212, 175, 55, 0.1);
        }

        .purchase-amount {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .purchase-amount img {
            width: 20px;
            height: 20px;
        }

        .purchase-cost {
            font-size: 14px;
            color: var(--dark-gray);
        }

        .custom-purchase {
            grid-column: 1 / -1;
        }

        .custom-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .custom-input-group input {
            flex: 1;
        }

        .currency {
            font-size: 14px;
            color: var(--dark-gray);
            white-space: nowrap;
        }

        /* Purchase Success Modal */
        .purchase-success {
            text-align: center;
            padding: 30px 20px;
        }

        .purchase-success-icon {
            width: 80px;
            height: 80px;
            background-color: var(--success-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            color: white;
            font-size: 36px;
            animation: successPulse 2s ease infinite;
        }

        .purchase-success-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--success-green);
            margin-bottom: 15px;
        }

        .purchase-success-message {
            font-size: 16px;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .purchase-success-details {
            background-color: var(--light-green);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .purchase-success-amount {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .purchase-success-amount img {
            width: 28px;
            height: 28px;
        }

        .purchase-success-cost {
            font-size: 16px;
            color: var(--dark-gray);
            margin-bottom: 5px;
        }

        .purchase-success-balance {
            font-size: 14px;
            color: var(--text-dark);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--medium-gray);
        }

        .close-success-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .close-success-btn:hover {
            background-color: #155c35;
            transform: translateY(-2px);
        }

        /* Info Box */
        .info-box {
            margin-top: 10px;
            padding: 16px;
            background-color: rgba(29, 111, 66, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--primary-green);
        }

        .dark-theme .info-box {
            background-color: rgba(46, 204, 113, 0.1);
        }

        .info-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 8px;
        }

        .info-text {
            font-size: 13px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Earn DeenPoints Section */
        .earn-deenpoints {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-green);
            border-radius: 12px;
        }

        .earn-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .earn-methods {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .earn-method {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-dark);
        }

        .earn-method i {
            color: var(--primary-green);
            font-size: 14px;
        }

        /* Page fade-in animation */
        @keyframes pageFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-content {
            animation: pageFadeIn 0.5s ease-out;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .scholar-card {
                padding: 16px;
                flex-direction: column;
            }
            
            .scholar-image {
                width: 70px;
                height: 70px;
                align-self: center;
            }
            
            .scholar-buttons {
                flex-direction: column;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .privacy-options {
                flex-direction: column;
            }
            
            .step-indicators {
                font-size: 11px;
            }
            
            .step-number {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .scholars-container {
                max-width: 700px;
            }
            
            .scholar-card {
                padding: 22px;
            }
        }

        @media (min-width: 1024px) {
            .scholars-container {
                max-width: 800px;
            }
        }
    </style>
</head>
<body class="light-theme">
    <!-- Page Loader Overlay -->
    <div id="pageLoader">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Page Transition Overlay with Islamic Loader -->
    <div class="page-transition-overlay" id="pageTransitionOverlay">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Modal Loader Overlay -->
    <div class="modal-loader-overlay" id="modalLoader">
        <div class="islamic-loader">
            <div class="loader-crescent">
                <div class="crescent"></div>
                <div class="loader-star">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="loader-text">Loading scholar information...</div>
        </div>
    </div>

    <!-- Ask Scholar Modal -->
    <div class="modal-overlay" id="askScholarModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-question-circle"></i>
                    <span>Ask a Scholar</span>
                </div>
                <div class="modal-deenpoints" id="modalDeenPointsBtn">
                    <img src="../img/deenPoints.png" alt="DeenPoints">
                    <span id="modalDeenPoints">750</span>
                </div>
                <button class="close-modal" id="closeAskScholarModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Step Indicators -->
                <div class="step-indicators">
                    <div class="step active" id="step1Indicator">
                        <div class="step-number">1</div>
                        <div class="step-label">Question</div>
                    </div>
                    <div class="step" id="step2Indicator">
                        <div class="step-number">2</div>
                        <div class="step-label">Priority</div>
                    </div>
                    <div class="step" id="step3Indicator">
                        <div class="step-number">3</div>
                        <div class="step-label">Success</div>
                    </div>
                </div>
                
                <!-- Step 1: Question Form -->
                <div class="step-content active" id="step1Content">
                    <div class="selected-scholar" id="selectedScholarDisplay">
                        <img id="selectedScholarImage" src="" alt="Scholar" class="selected-scholar-img">
                        <div class="selected-scholar-info">
                            <h4 id="selectedScholarName">Scholar Name</h4>
                            <p id="selectedScholarExpertise">Expertise Areas</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="questionTitle">Question Title</label>
                        <input type="text" class="form-input" id="questionTitle" placeholder="Brief title of your question">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="questionDetails">Question Details</label>
                        <textarea class="form-textarea" id="questionDetails" placeholder="Describe your question in detail..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category (Select one or more)</label>
                        <div class="category-options" id="categoryOptions">
                            <!-- Categories will be dynamically added -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Privacy Setting</label>
                        <div class="privacy-options">
                            <div class="privacy-option" data-privacy="public">
                                <div class="privacy-icon">
                                    <i class="fas fa-lock-open"></i>
                                </div>
                                <div class="privacy-label">Public</div>
                                <div class="privacy-desc">Can help others</div>
                            </div>
                            <div class="privacy-option" data-privacy="private">
                                <div class="privacy-icon">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <div class="privacy-label">Private</div>
                                <div class="privacy-desc">Only you & scholar</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-navigation">
                        <button class="modal-btn btn-secondary" id="cancelQuestionBtn">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button class="modal-btn btn-primary" id="nextStepBtn">
                            Next
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Priority Level -->
                <div class="step-content" id="step2Content">
                    <div class="important-note">
                        <div class="important-note-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Important Clarification</span>
                        </div>
                        <div class="important-note-text">
                            ⚠️ DeenPoints do NOT buy fatwas or opinions. Scholars answer only according to Islamic evidence and knowledge. DeenLink just helps in setting the priority and urgency of your questions.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Priority Level</label>
                        <div class="priority-options">
                            <div class="priority-option" data-priority="normal" data-cost="0">
                                <div class="priority-header">
                                    <div class="priority-name">
                                        <span>Normal</span>
                                    </div>
                                    <div class="priority-cost">
                                        Free
                                    </div>
                                </div>
                                <div class="priority-desc">Standard response time.</div>
                            </div>
                            
                            <div class="priority-option" data-priority="priority" data-cost="350">
                                <div class="priority-header">
                                    <div class="priority-name">
                                        <span>Priority</span>
                                        <span>⭐</span>
                                    </div>
                                    <div class="priority-cost">
                                        <img src="../img/deenPoints.png" alt="DeenPoints">
                                        350
                                    </div>
                                </div>
                                <div class="priority-desc">Your question is reviewed earlier.</div>
                            </div>
                            
                            <div class="priority-option" data-priority="urgent" data-cost="750">
                                <div class="priority-header">
                                    <div class="priority-name">
                                        <span>Urgent</span>
                                        <span>⭐⭐⭐</span>
                                    </div>
                                    <div class="priority-cost">
                                        <img src="../img/deenPoints.png" alt="DeenPoints">
                                        750
                                    </div>
                                </div>
                                <div class="priority-desc">For time-sensitive matters requiring quicker attention.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="additionalDeenPoints">Additional DeenPoints (Optional)</label>
                        <div class="deenpoints-input-container">
                            <input type="number" class="form-input deenpoints-input" id="additionalDeenPoints" min="0" max="1000" value="0" placeholder="0">
                            <div class="deenpoints-label">
                                <img src="../img/deenPoints.png" alt="DeenPoints">
                                <span>DeenPoints</span>
                            </div>
                        </div>
                        <p style="font-size: 12px; color: var(--dark-gray); margin-top: 5px;">
                            Add extra DeenPoints for even higher priority (optional)
                        </p>
                    </div>
                    
                    <div class="earn-deenpoints">
                        <div class="earn-title">
                            <i class="fas fa-coins"></i>
                            <span>Earn DeenPoints by:</span>
                        </div>
                        <div class="earn-methods">
                            <div class="earn-method">
                                <i class="fas fa-quran"></i>
                                <span>Participation in app activities like reading Quran, prayer times etc.</span>
                            </div>
                            <div class="earn-method">
                                <i class="fas fa-users"></i>
                                <span>Contributing to the community</span>
                            </div>
                            <div class="earn-method">
                                <i class="fas fa-handshake"></i>
                                <span>Supporting the DeenLink project</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-navigation">
                        <button class="modal-btn btn-secondary" id="backToStep1Btn">
                            <i class="fas fa-arrow-left"></i>
                            Back
                        </button>
                        <button class="modal-btn btn-primary" id="submitQuestionBtn">
                            <i class="fas fa-paper-plane"></i>
                            Submit Question
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Success Step -->
                <div class="step-content" id="step3Content">
                    <!-- Loading Overlay -->
                    <div class="loading-overlay" id="successLoadingOverlay">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Submitting your question...</div>
                        </div>
                    </div>
                    
                    <div class="success-step">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h2 class="success-title">Question Submitted Successfully!</h2>
                        <p class="success-message">Your question has been sent to the scholar. You will be notified when you receive a response.</p>
                        
                        <div class="success-details">
                            <div class="success-detail">
                                <span class="detail-label">Scholar:</span>
                                <span class="detail-value" id="successScholarName">Dr. Omar Suleiman</span>
                            </div>
                            <div class="success-detail">
                                <span class="detail-label">Priority:</span>
                                <span class="detail-value" id="successPriority">Normal</span>
                            </div>
                            <div class="success-detail">
                                <span class="detail-label">DeenPoints Used:</span>
                                <span class="detail-value deenpoints" id="successDeenPoints">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    0
                                </span>
                            </div>
                            <div class="success-detail">
                                <span class="detail-label">Estimated Response:</span>
                                <span class="detail-value" id="successResponseTime">2-3 days</span>
                            </div>
                        </div>
                        
                        <button class="done-btn" id="doneBtn">
                            <i class="fas fa-check-circle"></i>
                            Done
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase DeenPoints Modal -->
    <div class="modal-overlay" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-coins"></i>
                    <span>Purchase DeenPoints</span>
                </div>
                <button class="close-modal" id="closePurchaseModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Purchase Success Content -->
                <div class="purchase-success" id="purchaseSuccessContent" style="display: none;">
                    <div class="purchase-success-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 class="purchase-success-title">Purchase Successful!</h2>
                    <p class="purchase-success-message">Your DeenPoints have been added to your account.</p>
                    
                    <div class="purchase-success-details">
                        <div class="purchase-success-amount" id="purchaseSuccessAmount">
                            <img src="../img/deenPoints.png" alt="DeenPoints">
                            <span>0</span>
                        </div>
                        <div class="purchase-success-cost" id="purchaseSuccessCost">₦0.00</div>
                        <div class="purchase-success-balance">
                            New Balance: <strong id="newBalance">750</strong> DeenPoints
                        </div>
                    </div>
                    
                    <button class="close-success-btn" id="closeSuccessBtn">
                        <i class="fas fa-check-circle"></i>
                        Continue
                    </button>
                </div>
                
                <!-- Purchase Form Content -->
                <div id="purchaseFormContent">
                    <div class="info-box">
                        <div class="info-title">
                            <i class="fas fa-info-circle"></i>
                            <span>Current Balance</span>
                        </div>
                        <div class="info-text">
                            <div style="display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: 600;">
                                <img src="../img/deenPoints.png" alt="DeenPoints" style="width: 24px; height: 24px;">
                                <span id="currentBalanceDisplay">750</span>
                                <span>DeenPoints</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Quick Purchase Options</label>
                        <div class="purchase-options">
                            <div class="purchase-option" data-points="500" data-cost="750">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>500</span>
                                </div>
                                <div class="purchase-cost">₦750</div>
                            </div>
                            <div class="purchase-option" data-points="1000" data-cost="1500">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>1,000</span>
                                </div>
                                <div class="purchase-cost">₦1,500</div>
                            </div>
                            <div class="purchase-option" data-points="2500" data-cost="3750">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>2,500</span>
                                </div>
                                <div class="purchase-cost">₦3,750</div>
                            </div>
                            <div class="purchase-option" data-points="5000" data-cost="7500">
                                <div class="purchase-amount">
                                    <img src="../img/deenPoints.png" alt="DeenPoints">
                                    <span>5,000</span>
                                </div>
                                <div class="purchase-cost">₦7,500</div>
                            </div>
                            <div class="purchase-option custom-purchase">
                                <label class="form-label">Custom Amount</label>
                                <div class="custom-input-group">
                                    <input type="number" class="form-input" id="customDeenPoints" min="100" max="10000" placeholder="Enter amount">
                                    <span class="currency">DeenPoints</span>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px; color: var(--dark-gray);">
                                    Cost: <span id="customCostDisplay">₦0.00</span> (₦1.5 per DeenPoint)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="important-note">
                        <div class="important-note-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Important Note</span>
                        </div>
                        <div class="important-note-text">
                            ⚠️ DeenPoints do NOT buy fatwas or opinions. Scholars answer only according to Islamic evidence and knowledge. DeenLink just helps in setting the priority and urgency of your questions.
                        </div>
                    </div>
                    
                    <div class="modal-navigation">
                        <button class="modal-btn btn-secondary" id="cancelPurchaseBtn">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button class="modal-btn btn-primary" id="confirmPurchaseBtn">
                            <i class="fas fa-shopping-cart"></i>
                            Purchase
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-content" id="pageContent">
            <!-- Top Section -->
            <section class="top-section">
                <div class="top-section-background"></div>
                
                <div class="top-bar">
                    <button class="back-btn" id="backBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="page-title">
                        <i class="fas fa-user-graduate"></i>
                        <span>Browse Scholars</span>
                    </div>
                    <div class="deenpoints-balance" id="deenpointsBalanceBtn">
                        <img src="../img/deenPoints.png" alt="DeenPoints">
                        <span id="userDeenPoints">750</span>
                    </div>
                </div>
                
                <div class="page-subtitle">
                    <h1>Qualified Scholars</h1>
                    <p>Browse and select from our list of qualified Islamic scholars</p>
                </div>
            </section>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search scholars by name or expertise...">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>

            <!-- Scholars List -->
            <div class="scholars-container">
                <div class="scholars-count" id="scholarsCount">12 Scholars Found</div>
                
                <div class="scholars-list" id="scholarsList">
                    <!-- Scholars will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // PAGE TRANSITION LOADER IMPLEMENTATION
        // ============================================

        // DOM Elements
        const pageLoader = document.getElementById('pageLoader');
        const pageContent = document.getElementById('pageContent');

        // Function to show page loader
        function showPageLoader() {
            pageLoader.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Function to hide page loader
        function hidePageLoader() {
            pageLoader.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Function to check if two URLs are the same page
        function isSamePage(href, currentUrl) {
            // Get current page path without domain
            const currentPath = window.location.pathname;
            const currentHash = window.location.hash;
            
            // Handle different href formats
            if (href === '' || href === '#' || href === './' || href === '/') {
                // Home page links
                return currentPath.endsWith('/') || 
                       currentPath.endsWith('index.html') || 
                       currentPath === '/';
            }
            
            // Remove query strings and hashes for comparison
            const cleanHref = href.split('?')[0].split('#')[0];
            const cleanCurrentPath = currentPath.split('?')[0].split('#')[0];
            
            // Normalize paths
            const normalizePath = (path) => {
                // Remove leading/trailing slashes and index.html
                path = path.replace(/^\/|\/$/g, '');
                path = path.replace(/index\.html$/i, '');
                return path;
            };
            
            const normalizedHref = normalizePath(cleanHref);
            const normalizedCurrent = normalizePath(cleanCurrentPath);
            
            // Compare normalized paths
            return normalizedHref === normalizedCurrent;
        }

        // Intercept all link clicks for smooth page transitions
        document.addEventListener('click', function(e) {
            // Find the closest anchor element
            const anchor = e.target.closest('a');
            
            if (!anchor) return;
            
            const href = anchor.getAttribute('href');
            
            // Skip if no href, mailto, tel, javascript, or external links
            if (!href || 
                href.startsWith('javascript:') || 
                href.startsWith('mailto:') || 
                href.startsWith('tel:') ||
                href.startsWith('#') ||
                anchor.getAttribute('target') === '_blank') {
                return;
            }
            
            // Skip if it's an external link (starts with http and not same origin)
            if (href.startsWith('http') && !href.includes(window.location.origin)) {
                return;
            }
            
            // Check if we're clicking on the current page
            if (isSamePage(href, window.location.href)) {
                // Don't show loader for same page
                return;
            }
            
            // Prevent default navigation
            e.preventDefault();
            
            // Show page loader
            showPageLoader();
            
            // Fade out current content
            if (pageContent) {
                pageContent.style.opacity = '0';
                pageContent.style.transition = 'opacity 0.3s ease';
            }
            
            // Navigate after 1 second delay to allow loader to show properly
            setTimeout(() => {
                window.location.href = href;
            }, 1000);
        });

        // Hide loader when page is fully loaded
        window.addEventListener('load', function() {
            // Wait 100ms before hiding loader (smooth transition)
            setTimeout(hidePageLoader, 100);
            
            // Ensure content is visible
            if (pageContent) {
                pageContent.style.opacity = '1';
            }
            
            // Initialize the page
            initializePage();
            
            // Check for dark theme from settings
            checkDarkTheme();
        });

        // Also hide loader if page finishes loading after our transition
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                hidePageLoader();
                if (pageContent) {
                    pageContent.style.opacity = '1';
                }
            }
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function() {
            showPageLoader();
        });

        // Initial hide of loader (in case page loads fast)
        setTimeout(() => {
            if (document.readyState === 'complete') {
                hidePageLoader();
            }
        }, 100);

        // Back button functionality
        document.getElementById('backBtn').addEventListener('click', function() {
            showPageLoader();
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 300);
        });

        // ============================================
        // SCHOLARS DATA AND FUNCTIONALITY
        // ============================================
        
        // Sample scholars data
        const scholarsData = [
            {
                id: 1,
                name: "Dr. Omar Suleiman",
                image: "https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "American Islamic scholar, civil rights activist, and founder of Yaqeen Institute. Expert in contemporary Islamic issues.",
                expertise: ["Aqeedah", "Fiqh", "Contemporary Issues", "Youth Questions"],
                responseTime: "2-3 days"
            },
            {
                id: 2,
                name: "Mufti Ismail Menk",
                image: "https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Zimbabwean Islamic scholar known for his motivational talks. Focuses on spiritual development and practical Islam.",
                expertise: ["Spirituality", "Salah", "Family Matters", "Tauhid"],
                responseTime: "3-4 days"
            },
            {
                id: 3,
                name: "Shaykh Yasir Qadhi",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "American Islamic theologian, lecturer, and author. Dean of Academic Affairs at AlMaghrib Institute.",
                expertise: ["Aqeedah", "Quran", "Hadith", "Fiqh"],
                responseTime: "4-5 days"
            },
            {
                id: 4,
                name: "Ustadha Maryam Amir",
                image: "https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Female Islamic scholar specializing in women's issues, family matters, and spiritual development.",
                expertise: ["Marriage", "Family Matters", "Women's Issues", "Salah"],
                responseTime: "2-3 days"
            },
            {
                id: 5,
                name: "Dr. Zakir Naik",
                image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Indian Islamic preacher, speaker, and comparative religionist. Founder of Islamic Research Foundation.",
                expertise: ["Comparative Religion", "Aqeedah", "Quran", "Dawah"],
                responseTime: "5-7 days"
            },
            {
                id: 6,
                name: "Shaykh Abdul Nasir Jangda",
                image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Quran instructor and founder of Quran Revolution. Expert in Quranic Arabic and Tajweed.",
                expertise: ["Quran", "Tajweed", "Arabic", "Tafsir"],
                responseTime: "3-4 days"
            },
            {
                id: 7,
                name: "Dr. Shabir Ally",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Canadian Islamic scholar and president of Islamic Information & Dawah Centre International.",
                expertise: ["Comparative Religion", "Fiqh", "Contemporary Issues", "Dawah"],
                responseTime: "4-6 days"
            },
            {
                id: 8,
                name: "Ustadh Nouman Ali Khan",
                image: "https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Founder and CEO of Bayyinah Institute. Renowned for his Quranic linguistic analysis and Tafsir.",
                expertise: ["Quran", "Tafsir", "Arabic Linguistics", "Hadith"],
                responseTime: "5-7 days"
            },
            {
                id: 9,
                name: "Dr. Ingrid Mattson",
                image: "https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Canadian Muslim scholar and former president of Islamic Society of North America.",
                expertise: ["Fiqh", "Women's Issues", "Contemporary Issues", "Islamic History"],
                responseTime: "3-5 days"
            },
            {
                id: 10,
                name: "Shaykh Hamza Yusuf",
                image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "American Islamic scholar, co-founder of Zaytuna College. Expert in classical Islamic sciences.",
                expertise: ["Fiqh", "Aqeedah", "Tasawwuf", "Islamic Philosophy"],
                responseTime: "6-8 days"
            },
            {
                id: 11,
                name: "Mufti Abdur Rahman ibn Yusuf",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "British Islamic scholar and founder of White Thread Press. Expert in Hanafi jurisprudence.",
                expertise: ["Fiqh", "Hanafi Madhab", "Salah", "Marriage"],
                responseTime: "2-4 days"
            },
            {
                id: 12,
                name: "Dr. Jamal Badawi",
                image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80",
                description: "Egyptian Canadian Islamic scholar and author. Known for his work on Islam in the modern world.",
                expertise: ["Contemporary Issues", "Fiqh", "Family Matters", "Dawah"],
                responseTime: "4-6 days"
            }
        ];
        
        // Category data with icons
        const categories = [
            { id: 'fiqh', name: 'Fiqh (Jurisprudence)', icon: 'fas fa-balance-scale' },
            { id: 'aqeedah', name: 'Aqeedah (Creed)', icon: 'fas fa-book-quran' },
            { id: 'salah', name: 'Salah (Prayer)', icon: 'fas fa-person-praying' },
            { id: 'marriage', name: 'Marriage & Family', icon: 'fas fa-heart' },
            { id: 'quran', name: 'Quran Interpretation', icon: 'fas fa-quran' },
            { id: 'hadith', name: 'Hadith Sciences', icon: 'fas fa-book-open' },
            { id: 'tauhid', name: 'Tauhid (Monotheism)', icon: 'fas fa-star-and-crescent' },
            { id: 'youth', name: 'Youth Questions', icon: 'fas fa-users' },
            { id: 'dawah', name: 'Dawah (Invitation)', icon: 'fas fa-hands-praying' },
            { id: 'spirituality', name: 'Spirituality', icon: 'fas fa-spa' },
            { id: 'contemporary', name: 'Contemporary Issues', icon: 'fas fa-globe' },
            { id: 'general', name: 'General Islamic Questions', icon: 'fas fa-mosque' }
        ];
        
        // ============================================
        // GLOBAL STATE
        // ============================================
        
        let currentScholar = null;
        let currentStep = 1;
        let selectedPrivacy = 'public';
        let selectedPriority = 'normal';
        let priorityCost = 0;
        let selectedCategories = [];
        let userDeenPoints = 750; // Starting balance
        
        // ============================================
        // MODAL FUNCTIONALITY
        // ============================================
        
        const askScholarModal = document.getElementById('askScholarModal');
        const purchaseModal = document.getElementById('purchaseModal');
        const closeAskScholarModal = document.getElementById('closeAskScholarModal');
        const closePurchaseModal = document.getElementById('closePurchaseModal');
        const cancelQuestionBtn = document.getElementById('cancelQuestionBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        const backToStep1Btn = document.getElementById('backToStep1Btn');
        const submitQuestionBtn = document.getElementById('submitQuestionBtn');
        const doneBtn = document.getElementById('doneBtn');
        const cancelPurchaseBtn = document.getElementById('cancelPurchaseBtn');
        const confirmPurchaseBtn = document.getElementById('confirmPurchaseBtn');
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        const deenpointsBalanceBtn = document.getElementById('deenpointsBalanceBtn');
        const modalDeenPointsBtn = document.getElementById('modalDeenPointsBtn');
        const successLoadingOverlay = document.getElementById('successLoadingOverlay');
        const purchaseFormContent = document.getElementById('purchaseFormContent');
        const purchaseSuccessContent = document.getElementById('purchaseSuccessContent');
        
        // Modal loader element
        const modalLoader = document.getElementById('modalLoader');
        
        // Step elements
        const step1Content = document.getElementById('step1Content');
        const step2Content = document.getElementById('step2Content');
        const step3Content = document.getElementById('step3Content');
        const step1Indicator = document.getElementById('step1Indicator');
        const step2Indicator = document.getElementById('step2Indicator');
        const step3Indicator = document.getElementById('step3Indicator');
        
        // Selected scholar display elements
        const selectedScholarDisplay = document.getElementById('selectedScholarDisplay');
        const selectedScholarImage = document.getElementById('selectedScholarImage');
        const selectedScholarName = document.getElementById('selectedScholarName');
        const selectedScholarExpertise = document.getElementById('selectedScholarExpertise');
        
        // Success step elements
        const successScholarName = document.getElementById('successScholarName');
        const successPriority = document.getElementById('successPriority');
        const successDeenPoints = document.getElementById('successDeenPoints');
        const successResponseTime = document.getElementById('successResponseTime');
        
        // Purchase success elements
        const purchaseSuccessAmount = document.getElementById('purchaseSuccessAmount');
        const purchaseSuccessCost = document.getElementById('purchaseSuccessCost');
        const newBalance = document.getElementById('newBalance');
        
        // Form elements
        const questionTitleInput = document.getElementById('questionTitle');
        const questionDetailsInput = document.getElementById('questionDetails');
        const additionalDeenPointsInput = document.getElementById('additionalDeenPoints');
        const categoryOptionsContainer = document.getElementById('categoryOptions');
        const customDeenPointsInput = document.getElementById('customDeenPoints');
        const customCostDisplay = document.getElementById('customCostDisplay');
        const currentBalanceDisplay = document.getElementById('currentBalanceDisplay');
        const userDeenPointsDisplay = document.getElementById('userDeenPoints');
        const modalDeenPointsDisplay = document.getElementById('modalDeenPoints');
        
        // Initialize the page
        function initializePage() {
            renderScholars(scholarsData);
            setupSearch();
            setupModalEvents();
            setupPurchaseModalEvents();
            renderCategories();
            
            // Initialize privacy options
            setupPrivacyOptions();
            
            // Initialize priority options
            setupPriorityOptions();
            
            // Initialize purchase options
            setupPurchaseOptions();
            
            // Update scholars count
            updateScholarsCount(scholarsData.length);
            
            // Update DeenPoints displays
            updateDeenPointsDisplays();
            
            // Setup custom DeenPoints input
            setupCustomDeenPointsInput();
        }
        
        // Render categories
        function renderCategories() {
            categoryOptionsContainer.innerHTML = '';
            
            categories.forEach(category => {
                const categoryOption = document.createElement('div');
                categoryOption.className = 'category-option';
                categoryOption.dataset.id = category.id;
                
                categoryOption.innerHTML = `
                    <i class="${category.icon}"></i>
                    <span>${category.name}</span>
                `;
                
                categoryOption.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    
                    const categoryId = this.dataset.id;
                    if (this.classList.contains('selected')) {
                        if (!selectedCategories.includes(categoryId)) {
                            selectedCategories.push(categoryId);
                        }
                    } else {
                        selectedCategories = selectedCategories.filter(id => id !== categoryId);
                    }
                    
                    // Validate step 1
                    validateStep1();
                });
                
                categoryOptionsContainer.appendChild(categoryOption);
            });
        }
        
        // Render scholars list
        function renderScholars(scholars) {
            const scholarsList = document.getElementById('scholarsList');
            scholarsList.innerHTML = '';
            
            scholars.forEach(scholar => {
                const scholarCard = document.createElement('div');
                scholarCard.className = 'scholar-card';
                scholarCard.dataset.id = scholar.id;
                
                scholarCard.innerHTML = `
                    <img src="${scholar.image}" alt="${scholar.name}" class="scholar-image">
                    <div class="scholar-info">
                        <div class="scholar-name">${scholar.name}</div>
                        <div class="scholar-description">${scholar.description}</div>
                        <div class="scholar-expertise">
                            ${scholar.expertise.map(exp => `<span class="expertise-tag">${exp}</span>`).join('')}
                        </div>
                        <div class="scholar-buttons">
                            <button class="ask-scholar-btn" data-scholar-id="${scholar.id}">
                                <i class="fas fa-question-circle"></i>
                                Ask Scholar
                            </button>
                            <a href="profile.html?type=scholar&id=${scholar.id}" class="view-profile-btn">
                                <i class="fas fa-eye"></i>
                                View Profile
                            </a>
                        </div>
                    </div>
                `;
                
                scholarsList.appendChild(scholarCard);
            });
            
            // Add event listeners to Ask Scholar buttons
            document.querySelectorAll('.ask-scholar-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const scholarId = parseInt(this.dataset.scholarId);
                    openAskScholarModal(scholarId);
                });
            });
            
            // Add event listeners to View Profile buttons
            document.querySelectorAll('.view-profile-btn').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Show page loader for navigation
                    showPageLoader();
                });
            });
            
            // Add click event to scholar cards
            document.querySelectorAll('.scholar-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    if (!e.target.closest('.ask-scholar-btn') && !e.target.closest('.view-profile-btn')) {
                        const scholarId = parseInt(this.dataset.id);
                        openAskScholarModal(scholarId);
                    }
                });
            });
        }
        
        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    renderScholars(scholarsData);
                    updateScholarsCount(scholarsData.length);
                    return;
                }
                
                const filteredScholars = scholarsData.filter(scholar => {
                    // Search in name
                    if (scholar.name.toLowerCase().includes(searchTerm)) {
                        return true;
                    }
                    
                    // Search in description
                    if (scholar.description.toLowerCase().includes(searchTerm)) {
                        return true;
                    }
                    
                    // Search in expertise
                    const expertiseMatch = scholar.expertise.some(exp => 
                        exp.toLowerCase().includes(searchTerm)
                    );
                    
                    return expertiseMatch;
                });
                
                renderScholars(filteredScholars);
                updateScholarsCount(filteredScholars.length);
            });
        }
        
        // Update scholars count display
        function updateScholarsCount(count) {
            const scholarsCount = document.getElementById('scholarsCount');
            scholarsCount.textContent = `${count} Scholar${count !== 1 ? 's' : ''} Found`;
        }
        
        // Update DeenPoints displays
        function updateDeenPointsDisplays() {
            userDeenPointsDisplay.textContent = userDeenPoints;
            modalDeenPointsDisplay.textContent = userDeenPoints;
            currentBalanceDisplay.textContent = userDeenPoints;
        }
        
        // Open Ask Scholar modal with loader
        function openAskScholarModal(scholarId) {
            // Show modal loader
            modalLoader.classList.add('active');
            
            // Store the scholar ID for when loader completes
            setTimeout(() => {
                currentScholar = scholarsData.find(s => s.id === scholarId);
                
                if (!currentScholar) {
                    closeModalLoader();
                    return;
                }
                
                // Update selected scholar display
                selectedScholarImage.src = currentScholar.image;
                selectedScholarImage.alt = currentScholar.name;
                selectedScholarName.textContent = currentScholar.name;
                selectedScholarExpertise.textContent = currentScholar.expertise.join(', ');
                
                // Update DeenPoints display in modal
                modalDeenPointsDisplay.textContent = userDeenPoints;
                
                // Reset form
                resetForm();
                
                // Hide modal loader
                closeModalLoader();
                
                // Show modal
                askScholarModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }, 800); // 800ms delay to show the loader
        }
        
        // Close modal loader function
        function closeModalLoader() {
            modalLoader.classList.remove('active');
        }
        
        // Setup modal events
        function setupModalEvents() {
            // Close modal buttons
            closeAskScholarModal.addEventListener('click', closeAskScholarModalFunc);
            cancelQuestionBtn.addEventListener('click', closeAskScholarModalFunc);
            
            // Next step button
            nextStepBtn.addEventListener('click', goToStep2);
            
            // Back to step 1 button
            backToStep1Btn.addEventListener('click', goToStep1);
            
            // Submit question button
            submitQuestionBtn.addEventListener('click', submitQuestion);
            
            // Done button
            doneBtn.addEventListener('click', closeAskScholarModalFunc);
            
            // Validate step 1 inputs
            questionTitleInput.addEventListener('input', validateStep1);
            questionDetailsInput.addEventListener('input', validateStep1);
            
            // DeenPoints input validation
            additionalDeenPointsInput.addEventListener('input', validateStep2);
            
            // DeenPoints balance click
            deenpointsBalanceBtn.addEventListener('click', openPurchaseModal);
            modalDeenPointsBtn.addEventListener('click', openPurchaseModal);
            
            // Close modal when clicking outside
            askScholarModal.addEventListener('click', function(event) {
                if (event.target === askScholarModal) {
                    closeAskScholarModalFunc();
                }
            });
            
            // Close modals when clicking outside modal loader
            modalLoader.addEventListener('click', function(event) {
                if (event.target === modalLoader) {
                    closeModalLoader();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && askScholarModal.classList.contains('active')) {
                    closeAskScholarModalFunc();
                }
                if (event.key === 'Escape') {
                    closeModalLoader();
                }
            });
        }
        
        // Setup purchase modal events
        function setupPurchaseModalEvents() {
            closePurchaseModal.addEventListener('click', closePurchaseModalFunc);
            cancelPurchaseBtn.addEventListener('click', closePurchaseModalFunc);
            confirmPurchaseBtn.addEventListener('click', confirmPurchase);
            closeSuccessBtn.addEventListener('click', closePurchaseModalFunc);
            
            // Close modal when clicking outside
            purchaseModal.addEventListener('click', function(event) {
                if (event.target === purchaseModal) {
                    closePurchaseModalFunc();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && purchaseModal.classList.contains('active')) {
                    closePurchaseModalFunc();
                }
            });
        }
        
        // Setup privacy options
        function setupPrivacyOptions() {
            const privacyOptions = document.querySelectorAll('.privacy-option');
            
            privacyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    privacyOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Update selected privacy
                    selectedPrivacy = this.dataset.privacy;
                });
            });
            
            // Set default selection
            privacyOptions[0].classList.add('selected');
        }
        
        // Setup priority options
        function setupPriorityOptions() {
            const priorityOptions = document.querySelectorAll('.priority-option');
            
            priorityOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    priorityOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Update selected priority and cost
                    selectedPriority = this.dataset.priority;
                    priorityCost = parseInt(this.dataset.cost);
                    
                    // Update submit button state
                    validateStep2();
                });
            });
            
            // Set default selection
            priorityOptions[0].classList.add('selected');
        }
        
        // Setup purchase options
        function setupPurchaseOptions() {
            const purchaseOptions = document.querySelectorAll('.purchase-option:not(.custom-purchase)');
            
            purchaseOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    purchaseOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Clear custom input
                    customDeenPointsInput.value = '';
                    customCostDisplay.textContent = '₦0.00';
                });
            });
        }
        
        // Setup custom DeenPoints input
        function setupCustomDeenPointsInput() {
            customDeenPointsInput.addEventListener('input', function() {
                const points = parseInt(this.value) || 0;
                const cost = points * 1.5;
                
                if (points > 0) {
                    // Remove selection from other options
                    document.querySelectorAll('.purchase-option:not(.custom-purchase)').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                }
                
                customCostDisplay.textContent = `₦${cost.toFixed(2)}`;
            });
        }
        
        // Validate step 1
        function validateStep1() {
            const isTitleValid = questionTitleInput.value.trim().length > 0;
            const isDetailsValid = questionDetailsInput.value.trim().length > 10;
            const isCategoryValid = selectedCategories.length > 0;
            
            const isValid = isTitleValid && isDetailsValid && isCategoryValid;
            
            nextStepBtn.disabled = !isValid;
            
            return isValid;
        }
        
        // Validate step 2
        function validateStep2() {
            // Check if user has enough DeenPoints
            const additionalPoints = parseInt(additionalDeenPointsInput.value) || 0;
            const totalCost = priorityCost + additionalPoints;
            
            const hasEnoughPoints = totalCost <= userDeenPoints;
            
            submitQuestionBtn.disabled = !hasEnoughPoints;
            
            if (!hasEnoughPoints) {
                submitQuestionBtn.title = "Not enough DeenPoints. Click the DeenPoints balance to purchase more.";
            } else {
                submitQuestionBtn.title = "";
            }
            
            return hasEnoughPoints;
        }
        
        // Go to step 2
        function goToStep2() {
            if (!validateStep1()) return;
            
            // Update step indicators
            step1Indicator.classList.remove('active');
            step1Indicator.classList.add('completed');
            step2Indicator.classList.add('active');
            step3Indicator.classList.remove('active');
            step3Indicator.classList.remove('completed');
            
            // Update step content
            step1Content.classList.remove('active');
            step2Content.classList.add('active');
            step3Content.classList.remove('active');
            
            // Update current step
            currentStep = 2;
            
            // Validate step 2
            validateStep2();
        }
        
        // Go to step 1
        function goToStep1() {
            // Update step indicators
            step2Indicator.classList.remove('active');
            step1Indicator.classList.add('active');
            step1Indicator.classList.remove('completed');
            step3Indicator.classList.remove('active');
            step3Indicator.classList.remove('completed');
            
            // Update step content
            step2Content.classList.remove('active');
            step1Content.classList.add('active');
            step3Content.classList.remove('active');
            
            // Update current step
            currentStep = 1;
        }
        
        // Go to step 3 (success)
        function goToStep3() {
            // Show loading overlay
            successLoadingOverlay.classList.add('active');
            
            // Simulate processing delay
            setTimeout(() => {
                // Hide loading overlay
                successLoadingOverlay.classList.remove('active');
                
                // Update step indicators
                step2Indicator.classList.remove('active');
                step2Indicator.classList.add('completed');
                step3Indicator.classList.add('active');
                
                // Update step content
                step2Content.classList.remove('active');
                step3Content.classList.add('active');
                
                // Update current step
                currentStep = 3;
            }, 1500); // 1.5 second delay to simulate processing
        }
        
        // Submit question
        function submitQuestion() {
            if (!validateStep2()) return;
            
            // Calculate total DeenPoints cost
            const additionalPoints = parseInt(additionalDeenPointsInput.value) || 0;
            const totalCost = priorityCost + additionalPoints;
            
            // Update user balance
            userDeenPoints -= totalCost;
            updateDeenPointsDisplays();
            
            // Get selected category names
            const selectedCategoryNames = selectedCategories.map(catId => {
                const category = categories.find(c => c.id === catId);
                return category ? category.name : catId;
            });
            
            // Get priority display name
            let priorityDisplay = "Normal";
            if (selectedPriority === "priority") priorityDisplay = "Priority ⭐";
            if (selectedPriority === "urgent") priorityDisplay = "Urgent ⭐⭐⭐";
            
            // Update success step with details
            successScholarName.textContent = currentScholar.name;
            successPriority.textContent = priorityDisplay;
            successDeenPoints.innerHTML = `<img src="../img/deenPoints.png" alt="DeenPoints"> ${totalCost}`;
            successResponseTime.textContent = currentScholar.responseTime;
            
            // Go to success step
            goToStep3();
        }
        
        // Open purchase modal
        function openPurchaseModal() {
            // Update current balance display
            currentBalanceDisplay.textContent = userDeenPoints;
            
            // Show purchase form (hide success)
            purchaseFormContent.style.display = 'block';
            purchaseSuccessContent.style.display = 'none';
            
            // Show modal
            purchaseModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Show purchase success
        function showPurchaseSuccess(pointsAdded, cost) {
            // Update success content
            purchaseSuccessAmount.innerHTML = `<img src="../img/deenPoints.png" alt="DeenPoints"> <span>${pointsAdded}</span>`;
            purchaseSuccessCost.textContent = `₦${cost.toFixed(2)}`;
            newBalance.textContent = userDeenPoints;
            
            // Show success, hide form
            purchaseFormContent.style.display = 'none';
            purchaseSuccessContent.style.display = 'block';
        }
        
        // Confirm purchase
        function confirmPurchase() {
            let pointsToAdd = 0;
            let cost = 0;
            
            // Check if a quick purchase option is selected
            const selectedOption = document.querySelector('.purchase-option:not(.custom-purchase).selected');
            if (selectedOption) {
                pointsToAdd = parseInt(selectedOption.dataset.points);
                cost = parseInt(selectedOption.dataset.cost);
            } 
            // Check custom input
            else if (customDeenPointsInput.value) {
                pointsToAdd = parseInt(customDeenPointsInput.value);
                cost = pointsToAdd * 1.5;
            }
            
            if (pointsToAdd <= 0) {
                alert("Please select a purchase option or enter a custom amount.");
                return;
            }
            
            // In a real app, you would process payment here
            // For now, just add the points
            userDeenPoints += pointsToAdd;
            updateDeenPointsDisplays();
            
            // Show loading state
            confirmPurchaseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            confirmPurchaseBtn.disabled = true;
            
            // Simulate payment processing
            setTimeout(() => {
                // Reset button
                confirmPurchaseBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Purchase';
                confirmPurchaseBtn.disabled = false;
                
                // Show success message
                showPurchaseSuccess(pointsToAdd, cost);
            }, 1000); // 1 second delay to simulate processing
        }
        
        // Reset form
        function resetForm() {
            // Reset inputs
            questionTitleInput.value = '';
            questionDetailsInput.value = '';
            additionalDeenPointsInput.value = '0';
            
            // Reset categories
            selectedCategories = [];
            document.querySelectorAll('.category-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Reset privacy selection
            const privacyOptions = document.querySelectorAll('.privacy-option');
            privacyOptions.forEach(opt => opt.classList.remove('selected'));
            privacyOptions[0].classList.add('selected');
            selectedPrivacy = 'public';
            
            // Reset priority selection
            const priorityOptions = document.querySelectorAll('.priority-option');
            priorityOptions.forEach(opt => opt.classList.remove('selected'));
            priorityOptions[0].classList.add('selected');
            selectedPriority = 'normal';
            priorityCost = 0;
            
            // Reset to step 1
            if (currentStep !== 1) {
                goToStep1();
            }
            
            // Reset validation
            nextStepBtn.disabled = true;
            submitQuestionBtn.disabled = false;
        }
        
        // Close Ask Scholar modal
        function closeAskScholarModalFunc() {
            askScholarModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetForm();
            // Also ensure modal loader is closed if it's open
            closeModalLoader();
        }
        
        // Close purchase modal
        function closePurchaseModalFunc() {
            purchaseModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset purchase options
            document.querySelectorAll('.purchase-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            customDeenPointsInput.value = '';
            customCostDisplay.textContent = '₦0.00';
            
            // Reset to purchase form
            purchaseFormContent.style.display = 'block';
            purchaseSuccessContent.style.display = 'none';
            
            // If Ask Scholar modal is open, update its DeenPoints display and revalidate
            if (askScholarModal.classList.contains('active')) {
                modalDeenPointsDisplay.textContent = userDeenPoints;
                validateStep2();
            }
        }
        
        // ============================================
        // DARK THEME CHECK FROM SETTINGS
        // ============================================
        
        function checkDarkTheme() {
            // Check localStorage for theme preference (like the home page does)
            const savedTheme = localStorage.getItem('isDarkMode');
            const body = document.body;
            
            if (savedTheme === 'true') {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
            }
        }
    </script>
</body>
</html>